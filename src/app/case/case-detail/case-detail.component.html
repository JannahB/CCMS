<p-message *ngIf="staticMessage.visible" severity="{{staticMessage.severity}}" text="{{staticMessage.message}}">
</p-message>

<div class="ui-g">
  <!-- HEADER -->
  <div class="ui-g-12 pv-0 pl-0">
    <div class="ui-g-12 ui-md-8">
      <label class="minimal block mb-0">Case:</label>
      <h1 class="page-header mt-0">{{case?.caseNumber}}</h1>
    </div>

  </div>

  <!-- FIRST SECTION -->
  <div class="ui-g-12 card">

    <loading-bar [visible]="loadingCase" [message]="loadingMessage"></loading-bar>

    <div class="ui-g-12 ph-10">
      <div class="ui-g-12 ui-md-8">
        <h2 class="mb-0">Case Details</h2>
      </div>
      <div class="ui-g-12 ui-md-4 ta-r pb-0">

        <!-- <p-progressSpinner strokeWidth="4" [style]="{width: '30px', height: '30px'}"></p-progressSpinner> -->

        <button type="button" (click)="saveCase()" label="Save Case" icon="ui-icon-check" class="btn-big" pButton
          [disabled]="!caseForm.form.valid" *ngIf="hasPermission(Permission.CREATE_CASE)"></button>
      </div>
    </div>



    <div class="ui-g-12">
      <form #caseForm="ngForm" novalidate>
        <div *ngIf="case">

          <div class="ui-g-12 ui">
            <div class="ui-g-12 ui-md-2">
              <label class="minimal primary block">Filing Date</label>
              <p-calendar id="dtFilingDate" name="dtFilingDate" #dtFilingDate [required]="true"
                [disabled]="case.caseOID != 0 || !hasPermission(Permission.CREATE_CASE)"
                [(ngModel)]="case.caseFilingDate" dateFormat="dd-M-yy" placeholder="Case Filing Date" [showIcon]="true"
                yearRange="2000:2030" [yearNavigator]="true" appendTo="body"></p-calendar>
              <!-- (onSelect)="generalDetailsOnBlur($event)" -->
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="dtFilingDate.errors?.required && dtFilingDate.touched">
                Please choose a Filing Date
              </div>
            </div>

            <div class="ui-g-12 ui-md-2 pr-20">
              <label class="minimal block primary">Case Weight</label>
              <div class="mar-0">{{ case.caseWeight }}</div>
              <p-slider name="slCaseWeight" #slCaseWeight="ngModel" [disabled]="!hasPermission(Permission.CREATE_CASE)"
                [required]="true" min="1" [(ngModel)]="case.caseWeight" [style]="{'width':'100%'}" [min]="0" [max]="10"
                [animate]="true"></p-slider>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="slCaseWeight.errors?.min && slCaseWeight.touched">
                Please choose a Case Weight
              </div>
            </div>

            <div class="ui-g-12 ui-md-2 mt-25" *ngIf="case.caseOID > 0">
              <span class="md-inputfield">
                <input pInputText type="text" #tiprevCaseNumber="ngModel" required name="tiprevCaseNumber"
                  [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                  [required]="false" [(ngModel)]="case.prevCaseNumber" class="width-full">
                <label>Originating Case Number</label>
              </span>
            </div>

            <!-- Court of Appeal Number -->
            <div class="ui-g-12 ui-md-2 mt-25" *ngIf="case.caseOID > 0">
              <span class="md-inputfield">
                <input pInputText type="text" #tiprevCaseNumber="ngModel" required name="tiCourtofAppealCaseNumber"
                  [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                  [required]="false" [(ngModel)]="case.courtOfAppealNumber" class="width-full">
                <label>Court of Appeal Case Number</label>
              </span>
            </div>



            <!-- Case Caption Field -->
            <div class="ui-g-12 ui-md-4 mt-25" *ngIf="case.caseOID > 0">
              <span class="md-inputfield">
                <input pInputText type="text" #tiCaseCaption="ngModel" required name="tiCaseCaption"
                  [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                  [(ngModel)]="case.caseCaption" [required]="false" class="width-full">
                <label>Case Caption</label>
              </span>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="tiCaseCaption.errors?.required && tiCaseCaption.touched">
                Please enter a Case Caption
              </div>
            </div>

          </div>



          <div class="ui-g-12">

            <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Case Status</label>
              <p-dropdown name="ddCaseStaus" #ddCaseStaus placeholder="case status..."
                [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                [required]="true" optionLabel="name" [options]="caseStatuses" [filter]="true"
                [(ngModel)]="case.caseStatus" (onChange)="ddOnChange($event)" styleClass="width-full">
              </p-dropdown>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="ddCaseStaus.errors?.required && ddCaseStaus.touched">
                Please choose a Case Status
              </div>
            </div>

            <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Case Type</label>
              <!-- [disabled]="case.caseOID != 0" -->
              <p-dropdown name="ddCaseType" #ddCaseType placeholder="case type..."
                  [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                  [required]="true"
                  optionLabel="name"
                  [options]="caseTypes"
                  [filter]="true"
                  [(ngModel)]="case.caseType"
                  (onChange)="caseTypeChange($event)"
                  styleClass="width-full">
              </p-dropdown>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="ddCaseType.errors?.required && ddCaseType.touched">
                Please choose a Case Type
              </div>
            </div>

            <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Case Phase</label>
              <!-- [disabled]="!casePhases || !case.caseType || case.caseOID != 0" -->
              <p-dropdown name="ddCasePhase" #ddCasePhase placeholder="case phase..."
                  [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                  [required]="true"
                  (click)="isCaseTypeSelected($event)"
                  optionLabel="name"
                  [options]="casePhases"
                  [filter]="true"
                  [(ngModel)]="case.casePhase"
                  (onChange)="ddOnChange($event)"
                  styleClass="width-full">
              </p-dropdown>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="ddCasePhase.errors?.required && ddCasePhase.touched">
                Please choose a Case Phase
              </div>
            </div>

            <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Case Sub Type</label>
              <!-- [disabled]="!casePhases || !case.caseType || case.caseOID != 0" -->
              <p-dropdown name="ddCaseSubPhase" #ddCasePhase placeholder="case subtype..."
                [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                [required]="true" (click)="isCaseTypeSelected($event)" optionLabel="name" [options]="caseSubTypes"
                [(ngModel)]="case.caseSubType" (onChange)="ddOnChangeSubType($event)" styleClass="width-full"
                [filter]="true">
              </p-dropdown>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="ddCasePhase.errors?.required && ddCasePhase.touched">
                Please choose a Case Sub Type
              </div>
            </div>


          </div>

  
            <div class="ui-g-12 ui">
  
              <div class="ui-g-12 ui-md-3" *ngIf="case.caseOID != 0">
                <label class="minimal primary block">Disposition Date</label>
                <p-calendar id="DispositionDate" name="DispositionDate" #finalDispositionDate
                      
                      [required]="false"
                      [disabled]="!hasPermission(Permission.CREATE_CASE)"
                      [(ngModel)]="case.caseDispositionDate"
                      dateFormat="mm/dd/yy"
                      placeholder="Disposition Date"
                      [showIcon]="true"
                      yearRange="2000:2030"
                      [yearNavigator]="true"
                      appendTo="body" ></p-calendar>
                <div class="ui-message ui-messages-error ui-corner-all"
                    *ngIf="dtFilingDate.errors?.required && dtFilingDate.touched" >
                      Please choose a Dispisition Date
                </div>
              </div>
  
              <div class="ui-g-12 ui-md-5" *ngIf="case.caseOID != 0">
                <label class="minimal primary block">Disposition Type</label>
                <p-dropdown name="ddCaseDispositionType" #ddCaseDispositionType placeholder="Disposition Type"
                    [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                    [required]="false"
                    [filter] = "true"
                    optionLabel="name"
                    [disabled]="!hasPermission(Permission.CREATE_CASE)"
                    [options]="caseDispositionTypes"
                    [(ngModel)]="case.caseDispositionType"
                    (onChange)="caseDispositionTypeChange($event)"
                    styleClass="width-full">
                </p-dropdown>
                <div class="ui-message ui-messages-error ui-corner-all"
                    *ngIf="ddCaseType.errors?.required && ddCaseType.touched" >
                      Please choose a Disposition Type
                </div>
              </div>
            </div>  
            
                      <!-- Adding Case Notes Field  -->
            <div class="ui-g-12 mb-20" *ngIf="case.caseOID > 0">
                <label class="minimal primary block">Case Notes</label>
                  <textarea name="tiCaseNotes"
                      [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                      [rows]="2"
                      [cols]="30"
                      autoResize="autoResize"
                      pInputTextarea placeholder="Enter Case Notes"
                      [(ngModel)]="case.caseNotes"
                      class="width-full">
                   </textarea>
          </div>



        <!-- CASE PARTIES TABLE -->

          <div class="ui-g-12 mt-20 ph-0">

            <div class="ui-g-12 ui-md-6">
              <h2 class="mb-10">Case Parties</h2>
            </div>

            <div class="ui-g-12 ui-md-6 ta-r pos-relative">
              <button type="button" *ngIf="hasPermission(Permission.CREATE_CASE)" (click)="showAddCaseParty();"
                label="Add Case Party" icon="ui-icon-add" class="ui-button-secondary mr-15 abs-btn" pButton></button>
            </div>

            <div class="ui-g-12">
              <p-dataTable [value]="case.caseParties" selectionMode="single" [(selection)]="selectedParty"
                (onRowSelect)="partyOnRowSelect($event)" scrollable="true" scrollHeight="200px"
                dataKey="caseParty.partyOID" #dtParties>

                <p-column field="caseParty.isOrganization" header="Is Org?" [style]="{'width':'8%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <i class="fa ui-icon-check task-done" *ngIf="item.caseParty.isOrganization"></i>
                  </ng-template>
                </p-column>

                <p-column field="role.name" header="Role" [style]="{'width':'10%'}"></p-column>

                <p-column header="Party Info" [style]="{'width':'30%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <div>
                      {{item.caseParty.fullName?item.caseParty.fullName:item.caseParty.firstName+" "+item.caseParty.lastName}}
                    </div>
                    <!-- Christian : turned this on with fullName support on Server -->
                    <div></div>
                    <div *ngIf="!item.caseParty.isOrganization">
                      <span class="smaller">
                        DOB: {{ item.caseParty.dob | date:'dd-MMM-yyyy' }}
                        Sex: {{ item.caseParty.sex }}
                        Age: {{ item.caseParty.age }}
                      </span>
                    </div>
                  </ng-template>
                </p-column>

                <!-- <p-column field="caseParty.firstName" header="First Name" [style]="{'width':'15%'}"></p-column>
                <p-column field="caseParty.lastName" header="Last Name" [style]="{'width':'15%'}"></p-column>
                <p-column field="caseParty.sex" header="Sex" [style]="{'width':'7%'}"></p-column>
                <p-column header="Date of Birth" [style]="{'width':'13%'}">
                    <ng-template pTemplate="body" let-item="rowData">
                        {{ item.caseParty.dob | date:'M/d/yyyy' }}
                    </ng-template>
                </p-column>
                <p-column field="caseParty.age" header="Age" [style]="{'width':'7%'}"></p-column> -->

                <p-column field="startDate" header="Start Date" [style]="{'width':'13%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{item.startDate | date:'dd-MMM-yyyy'}}

                  </ng-template>
                </p-column>
                <p-column field="endDate" header="End Date" [style]="{'width':'13%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{item.endDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
                </p-column>
                <!-- <p-column styleClass="col-button" header="Delete" [style]="{'width':'8%'}">
                    <ng-template let-item="rowData" pTemplate="body">
                        <i class="material-icons delete-icon" (click)="requestDeleteParty(item)">delete</i>
                    </ng-template>
                </p-column> -->
              </p-dataTable>
            </div>
          </div>

        <!-- CASE APPLICATIONS -->

        <div class="ui-g-12 mt-20 ph-0">

          <div class="ui-g-12 ui-md-6">
            <h2 class="mb-10">Case Applications</h2>
          </div>

          <div class="ui-g-12 ui-md-6 ta-r pos-relative">
            <button type="button"
                *ngIf="hasPermission(Permission.CREATE_CASE)"
                (click)="resetAddCaseApplicationModal();"
                label="Add Case Application"
                icon="ui-icon-add"
                class="ui-button-secondary mr-15 abs-btn" pButton></button>
          </div>

          <div class="ui-g-12">
            <p-dataTable [value]="case.caseApplications"
                        selectionMode="single"
                        [(selection)]="selectedCaseApplication"
                        (onRowSelect)="showAddCaseCaseApplication($event)"
                        scrollable="true" scrollHeight="200px"
                        dataKey="caseApplicationOID" #dtCaseApps>

              <p-column field="caseApplicationNumber" header="Application #" [style]="{'width':'10%'}" [sortable]="true"></p-column>
              <p-column field="caseApplicationObjType.name" header="Application Type" [style]="{'width':'10%'}" [sortable]="true"></p-column>
              <p-column field="caseApplicationStatus" header="Application Status" [style]="{'width':'10%'}" [sortable]="true">
                <!--ng-template let-item="rowData" pTemplate="body">
                  {{ getApplicationStatusDesc(item.caseApplicationStatus)}}
               </ng-template-->
              </p-column>
              <!--p-column field="applicantName" header="Applicant Name" [style]="{'width':'10%'}"></p-column>
              <p-column field="applicantRole" header="Applicant Role" [style]="{'width':'10%'}"></p-column-->
              <p-column field="caseApplicationStartDate" header="Start Date" [style]="{'width':'10%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.caseApplicationStartDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
              </p-column>
              <p-column field="caseApplicationEndDate" header="End Date" [style]="{'width':'10%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.caseApplicationEndDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
              </p-column>
              
            </p-dataTable>
          </div>
        </div>           



          <!-- CHARGES TABLE -->

          <!--div class="ui-g-12 mt-30">

            <div class="ui-g-12 ui-md-6">
              <h2 class="mb-10">Charges</h2>
            </div>
            <div class="ui-g-12 ui-md-6 ta-r pos-relative">
              <button type="button"
                  *ngIf="hasPermission(Permission.UPDATE_CASE)"
                  (click)="onAddCaseCharge(caseChargeForm)"
                  label="Add Case Charge"
                  icon="ui-icon-add"
                  class="ui-button-secondary mr-15 abs-btn" pButton></button>
            </div>

            <div class="ui-g-12">

              <
                ******** NEW TABLE ***********
                Waiting for Aaron to add the
                dependency tree in case data
                ******************************
              -->
          <!-- <p-dataTable [value]="case.caseCharges"
                          selectionMode="single"
                          [(selection)]="selectedCharge"
                          (onRowSelect)="caseOnRowSelect($event)"
                          dataKey="caseChargeOID" #dtCharges>
                <p-column header="#" field="" [style]="{'width':'12%'}">
                  <ng-template pTemplate="body" let-n="rowIndex">
                    {{n+1}}
                  </ng-template>
                </p-column>
                <p-column header="Section" field="iccsCode.categoryIdentifier" [style]="{'width':'12%'}"></p-column>
                <p-column header="Division" field="" [style]="{'width':'12%'}"></p-column>
                <p-column header="Group" field="" [style]="{'width':'12%'}"></p-column>
                <p-column header="Class" field="" [style]="{'width':'12%'}"></p-column>
                <p-column header="Charge/Law" field="localCharge.localCharge" [style]="{'width':'30%'}"></p-column>
                <p-column header="Lead Charge Description" field="leaChargingDetails" [style]="{'width':'15%'}"></p-column>
                <p-column header="Charge Factors" field="" [style]="{'width':'25%'}">
                    <ng-template pTemplate="body" let-item="rowData">
                      <div *ngFor="let factor of item.chargeFactors; let i = index">
                        {{i+1}}) {{factor.description}}
                      </div>
                    </ng-template>
                </p-column>
                <p-column header="Start Date" field="" [style]="{'width':'12%'}"></p-column>
                <p-column header="End Date"   field="" [style]="{'width':'12%'}"></p-column>

                <p-column header="Delete" styleClass="col-button" [style]="{'width':'8%'}">
                    <ng-template let-item="rowData" pTemplate="body">
                        <i class="material-icons delete-icon" (click)="requestDeleteCharge(item)">delete</i>
                    </ng-template>
                </p-column>
              </p-dataTable> -->

          <!--ng-template pTemplate="body" let-item="rowData">
                <div *ngFor="let factor of item.chargeFactors; let i = index">
                "Testing"
                </div>
              </ng-template>


              <p-dataTable [value]="case.caseCharges"
                          selectionMode="single"
                          [(selection)]="selectedCharge"
                          (onRowSelect)="caseOnRowSelect($event)"
                          scrollable="true" scrollHeight="200px"
                          dataKey="caseChargeOID" #dtCharges>
                <p-column field="iccsCode.categoryIdentifier" header="UN Code" [style]="{'width':'7%'}"></p-column>
                <p-column field="iccsCode.categoryName" header="UNODC Charge Description" [style]="{'width':'15%'}"></p-column>
                <p-column field="leaChargingDetails" header="Police Description" [style]="{'width':'15%'}"></p-column>
                <p-column field="iccsCode.categoryName" header="Charge Factors" [style]="{'width':'25%'}"></p-column>
                <p-column field="localCharge.localLaw" header="Legislation" [style]="{'width':'30%'}"></p-column>
                <p-column styleClass="col-button" header="Delete" [style]="{'width':'8%'}">
                    <ng-template let-item="rowData" pTemplate="body">
                        <i class="material-icons delete-icon" (click)="requestDeleteCharge(item)">delete</i>
                    </ng-template>
                </p-column>
              </p-dataTable>
            </div>
          </div-->

          <p-message *ngIf="staticMessage.visible" severity="{{staticMessage.severity}}"
            text="{{staticMessage.message}}"></p-message>

          <!-- CASE SAVE BUTTON -->
          <div class="ui-g-12 ta-r mt-30">
            <button type="button" *ngIf="hasPermission(Permission.CREATE_CASE)" (click)="saveCase()" label="Save Case"
              icon="ui-icon-check" class="btn-big" pButton [disabled]="!caseForm.form.valid"></button>
          </div>

        </div>
      </form>
    </div>
  </div>
  <!-- //END FISRT CARD -->


  <!-- SECOND CARD - TAB SECTION -->
  <div class="ui-g-12 card" *ngIf="case && case.caseOID && case.caseOID > 0">

    <div *ngIf="case">

      <p-tabView [activeIndex]="activeTabIndex">

        <!-- EVENTS TAB -->

        <p-tabPanel header="Register" leftIcon="ui-icon-list">
          <div class="ui-g">
            <div class="ui-g-12 ui-md-4">
              <h2>Case Events</h2>
            </div>

            <!-- <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Event Category Filter</label>
              <p-dropdown
                  placeholder="Event Category filter..."
                  [options]="eventTypes"
                  [(ngModel)]="eventTypeFilter"
                  optionLabel="eventTypeName"
                  (onChange)="eventCategoryFilterChange($event)"
                  styleClass="width-auto">
              </p-dropdown>
              <button label="" type="button" class="ml-10 ui-button-secondary ui-button-icon-only clear-btn inline" pButton icon="fa-close" (click)="clearEventFilter()"></button>
            </div> -->

            <div class="ui-g-12 ui-md-8">
                <label class="minimal primary block">Event Description Filter</label>
                <p-dropdown
                    styleClass="strokeWidth"
                    [style]="{'width': '400px'}"
                    placeholder="Event ID filter..."
                    [options]="eventTypes"
                    [filter] = "true"
                    [(ngModel)]="eventTypeFilter"
                    optionLabel="description"
                    (onChange)="eventTypeFilterChange($event)">
                </p-dropdown>
                <button label="" type="button" class="ml-10 ui-button-secondary ui-button-icon-only clear-btn inline" pButton icon="fa-close" (click)="clearEventFilter()"></button>
              </div>

            <div class="ui-g-12">
              <p-dataTable [value]="filteredEvents" selectionMode="single" [(selection)]="caseEvent"
                (onRowSelect)="caseEventOnRowSelect($event)" scrollable="true" dataKey="caseEventOID" #dtCaseEvents>
                <!-- <p-column styleClass="col-button" header="Done" [style]="{'width':'6%'}">
                  <ng-template let-item="rowData" pTemplate="body">
                      <i class="fa ui-icon-check task-done" *ngIf="item.eventType?.description == 'Task Completed'"></i>
                      <i class="fa ui-icon-close" *ngIf="item.eventType?.description != 'Task Completed'"></i>
                  </ng-template>
                </p-column> -->
                <p-column field="eventDate" header="Date/Time" [style]="{'width':'12%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{item.eventDate | date:'medium'}}
                  </ng-template>
                </p-column>
                <p-column header="Entering Party" [style]="{'width':'13%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{ item.enteringParty?.firstName }} {{ item.enteringParty?.lastName }}
                  </ng-template>
                </p-column>
                <p-column field="eventType.eventCategoryText" header="Event Category" [style]="{'width':'10%'}"
                  [sortable]="true"></p-column>
                <!-- <p-column field="eventType.eventTypeName" header="Event ID" [style]="{'width':'8%'}"></p-column> -->
                <p-column header="Event ID: Description" [style]="{'width':'25%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{ item.eventType?.eventTypeName }}: {{ item.eventType?.description }}
                  </ng-template>
                </p-column>
                <p-column field="description" header="Event Details" styleClass="text-break" [style]="{'width':'35%'}">
                </p-column>
              </p-dataTable>

            </div>
            <div class="ui-g-12">
              <button type="button" (click)="addCaseEventClicked()" label="Add Completed Event" icon="ui-icon-add"
                class="ui-button-secondary mr-15" pButton></button>
            </div>
          </div>
        </p-tabPanel>


        <!-- TASKS TAB -->
        <p-tabPanel header="Case Tasks" leftIcon="ui-icon-timer">

          <div class="ui-g">
            <div class="ui-g-12">
              <h2>Case Tasks</h2>
            </div>

            <div class="ui-g-12 ta-r mt-30">
              <button type="button" *ngIf="hasPermission(Permission.CREATE_TASK)" (click)="createCaseTask()"
                label="Add Case Task" icon="ui-icon-add" class="ui-button-secondary mr-15" pButton></button>
            </div>

            <div class="ui-g-12">
              <p-dataTable [value]="case.caseTasks" selectionMode="single" [(selection)]="selectedCaseTask"
                (onRowSelect)="taskOnRowSelect($event)" scrollable="true" dataKey="taskOID" #dtTasks>

                <p-column field="taskType.name" header="Task Type" [style]="{'width':'10%'}" [sortable]="true">
                </p-column>
                <p-column field="taskType.description" header="Task Description" [style]="{'width':'10%'}"
                  [sortable]="true"></p-column>
                <p-column field="taskDetails" header="Task Details" [style]="{'width':'10%'}" [sortable]="true">
                </p-column>
                <p-column field="docTemplate.documentName" header="Document to Generate" [style]="{'width':'10%'}"
                  [sortable]="true"></p-column>



                <p-column header="Priority" field="" [style]="{'width':'6%'}">
                  <ng-template let-item="rowData" pTemplate="body">
                    {{ getPriorityValue(item.taskPriorityCode)}}
                  </ng-template>
                </p-column>

                <p-column field="" header="Assigned Group" [style]="{'width':'10%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <!--div *ngIf="item.assignedParty?.partyOID">
                        {{ 'Party: ' + item.assignedParty.firstName + ' ' + item.assignedParty.lastName }}
                      </div-->
                    <div *ngIf="item.assignedPool?.poolOID">
                      {{ item.assignedPool.poolName }}
                    </div>
                  </ng-template>
                </p-column>

                <p-column field="assignedDate" header="Assigned Date" [style]="{'width':'8%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{item.assignedDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
                </p-column>

                <p-column field="taskDueDate" header="Due Date and Time" [style]="{'width':'9%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                    <div>
                      {{item.taskDueDate | date:'dd-MMM-yyyy hh:mm a'}}
                    </div>
                  </ng-template>
                </p-column>

                <!--p-column field="taskCheckedOutBy" header="Task Checked Out" [style]="{'width':'5%'}" [sortable]="true"></p-column-->

                <p-column header="Task Checked Out" field="" [style]="{'width':'6%'}" [sortable]="true">
                  <ng-template let-item="rowData" pTemplate="body">
                    <div *ngIf="item.taskCheckedOutBy">
                      {{ getTaskCheckoutValue(item.taskCheckedOutBy)}}
                    </div>
                  </ng-template>
                </p-column>

                <p-column field="" header="Task Checked Out By" [style]="{'width':'8%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <!--div *ngIf="item.taskCompletedByParty?.partyOID">
                        {{item.taskCompletedByParty.firstName + ' ' + item.taskCompletedByParty.lastName}}
                      </div-->
                    <div *ngIf="item.taskCheckedOutByParty?.partyOID">
                      {{ item.taskCheckedOutByParty.firstName + ' ' + item.taskCheckedOutByParty.lastName }}
                    </div>
                  </ng-template>
                </p-column>

                <p-column field="" header="Task Completed By" [style]="{'width':'10%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <div *ngIf="item.taskCompletedByParty?.partyOID">
                      {{item.taskCompletedByParty.firstName + ' ' + item.taskCompletedByParty.lastName}}
                    </div>
                  </ng-template>
                </p-column>

                <p-column field="taskDoneDate" header="Completion Date" [style]="{'width':'8%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{item.taskDoneDate | date:'dd-MMM-yyyy hh:mm a'}}
                  </ng-template>
                </p-column>

              </p-dataTable>

            </div>




            <div class="ui-g-12 ta-r mt-30">
              <button type="button" *ngIf="hasPermission(Permission.CREATE_CASE)" (click)="saveCase()" label="Save Case"
                icon="ui-icon-check" class="btn-big" pButton [disabled]="!caseForm.form.valid"></button>
            </div>


          </div>
        </p-tabPanel>

        <!-- OLD DOCUMENTS TAB  -->

        <!-- <p-tabPanel header="Documents" leftIcon="ui-icon-insert-drive-file" >
          <div class="ui-g">
            <div class="ui-g-12">
                <h2>Documents</h2>
            </div>
            <div class="ui-g-12 pt-0" *ngIf="hasPermission(Permission.UPDATE_CASE)">
              <div class="ui-g-12 ui-md-6">
                <h4 class="mt-0 mb-10">Generate Document</h4>
                <div class="ui-g-12 ui-md-6"> -->
        <!-- <label class="minimal primary block">Generate Document</label> -->
        <!-- TODO: Get document types lookup data -->
        <!-- <p-dropdown
                      placeholder="document type..."
                      [options]="documentTemplateTypes"
                      [(ngModel)]="selectedDocumentTemplateType"
                      optionLabel="documentName"
                      (onChange)="ddOnChange($event)"
                      styleClass="width-full">
                  </p-dropdown>
                </div>
                <div class="ui-g-12 ui-md-6 pv-0">
                    <button type="button"
                        (click)="generateDoc()"
                        label="Generate"
                        icon="ui-icon-settings-applications"
                        class="ui-button-secondary inline" pButton></button>
                </div>
              </div> -->
        <!-- FILE UPLOAD -->
        <!-- <div class="ui-g-12 ui-md-6 ta-r">
                <h4 class="mt-0 mb-10">Upload Document</h4>

                  <p-fileUpload mode="basic" name="theFiles[]" url="{{baseURL}}/GetAttachment" (onUpload)="onUpload($event)"
                      (onBeforeSend)="onBeforeSendFile($event)"
                      multiple="multiple" accept="application/pdf" maxFileSize="20000000"> -->
        <!-- accept="*.doc, *.docx, application/pdf" -->
        <!-- <ng-template pTemplate="content">
                          <ul *ngIf="uploadedFiles.length">
                              <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
                          </ul>
                      </ng-template>
                  </p-fileUpload>
              </div>
            </div>

            <div class="ui-g-12">
                <p-dataTable [value]="case.caseDocs"
                            selectionMode="single"
                            [(selection)]="selectedDoc"
                            (onRowSelect)="docOnRowSelect($event)"
                            scrollable="true"
                            dataKey="documentOID" #dtDocs>
                    <p-column field="lastUpdateDate" header="Document Date" [style]="{'width':'25%'}">
                        <ng-template pTemplate="body" let-item="rowData">
                            {{item.lastUpdateDate | date:'medium'}}
                        </ng-template>
                    </p-column>
                    <p-column field="" header="Document Name" [style]="{'width':'75%'}">
                        <ng-template pTemplate="body" let-item="rowData" styleClass="text-break">
                            <span>
                                <a href="{{baseURL + '/GetDocument?' + item.documentURL}}" target="_blank">{{item.documentName}}</a>
                            </span>
                            <div style="font-size:10px">{{baseURL + '/GetDocument?' + item.documentURL}}</div>
                        </ng-template>
                    </p-column>
                </p-dataTable>
            </div>
          </div>
        </p-tabPanel> -->

        <!-- DOCUMENTS TAB  -->

        <p-tabPanel header="Documents" leftIcon="ui-icon-insert-drive-file">
          <div class="ui-g">
            <div class="ui-g-12">
              <h2>Documents</h2>
            </div>
            <div class="ui-g-12 pt-0" *ngIf="hasPermission(Permission.UPDATE_CASE)">
              <div class="ui-g-6">
                <h4 class="mt-0 mb-10">Generate Document</h4>
                <div class="ui-g-4">
                  <!-- <label class="minimal primary block">Generate Document</label> -->
                  <!-- TODO: Get document types lookup data-->
                  <!--spiffy -->
                  <p-dropdown placeholder="document type..." [options]="courtDocs"
                    [(ngModel)]="selectedDocumentTemplateType" optionLabel="name" (onChange)="ddOnChange($event)"
                    styleClass="width-full" [filter]="true" filterBy="label,value.name">
                  </p-dropdown>
                </div>
                <div class="ui-g-2 pv-0">
                  <button type="button" (click)="generateDoc()" label="Generate" icon="ui-icon-settings-applications"
                    class="ui-button-secondary inline" pButton></button>
                </div>
              </div>



              <!-- FILE UPLOAD -->
              <div class="ui-g-6">
                <p-dialog width="700" header="Uploading" [(visible)]="uploadPVis" [responsive]="true" showEffect="fade"
                  [modal]="true" [closable]="false">
                  <loading-bar [visible]="uploadPVis" [message]="uploadPMsg"></loading-bar>
                  <div [style.height.px]="600">
                  </div>

                </p-dialog>
                <h4 class="mt-0 mb-10">Upload Document</h4>


                <div class="ui-g-12">
                  <div class="ui-g-6">
                    <p-dropdown name="docCat" (onChange)="ddOnDocCatChange($event)" placeholder="category..."
                      optionLabel="name" [autoWidth]="false" [style]="{'width': '100%'}" [options]="docTypesCategories"
                      [(ngModel)]="selCatDT" [filter]="true" filterBy="label,value.name"></p-dropdown>
                  </div>
                  <div class="ui-g-6">
                    <p-dropdown name="DocFil" #ddDocFil placeholder="type..." optionLabel="name" [autoWidth]="false"
                      [style]="{'width': '100%'}" [(ngModel)]="selDocTypeUpload" [options]="docTypesShown"
                      [filter]="true" filterBy="label,value.name"></p-dropdown>
                  </div>
                  <div class="ui-g-12 ta-r">
                    <p-fileUpload mode="basic" name="theFiles[]" url="{{baseURL}}/GetAttachment"
                      (onUpload)="onUpload($event)" (onBeforeSend)="onBeforeSendFile($event)" multiple="multiple"
                      accept="application/pdf" maxFileSize="20000000">
                      <!-- accept="*.doc, *.docx, application/pdf" -->
                      <ng-template pTemplate="content">
                        <ul *ngIf="uploadedFiles.length">
                          <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
                        </ul>
                      </ng-template>
                    </p-fileUpload>
                  </div>
                </div>

              </div>

            </div>
            <div class="ui-g-12">
              <h4 class="mt-0 mb-10">Filter</h4>
              <div class="ui-g-3">
                <p-dropdown (onChange)="ddOnFilterDTChange($event)" placeholder="category..." optionLabel="name"
                  [autoWidth]="false" [style]="{'width': '100%'}" [options]="docTypesFilter" [(ngModel)]="filterDT">
                </p-dropdown>
              </div>

              <div class="ui-g-3">
                <input placeholder="Fuzzy Document Search" pInputText type="text" #tiCaseCaption="ngModel"
                  [(ngModel)]="dtFilterText" (ngModelChange)="onDtFilterTextChange($event)" class="width-full">
              </div>

            </div>


            <div class="ui-g-12">
              <p-dataTable [value]="filterDocs" selectionMode="single" [(selection)]="selectedDoc"
                (onRowSelect)="docOnRowSelect($event)" scrollable="false" scrollHeight="280px" dataKey="documentOID"
                #dtDocs>
                <p-column field="lastUpdateDate" header="Document Date" [style]="{'width':'25%'}">
                  <ng-template pTemplate="body" let-item="rowData">

                    {{item.lastUpdateDate | date:'medium'}}

                    <!-- {{item.lastUpdateDate | date:'d/M/yy'}} -->
                  </ng-template>
                </p-column>
                <p-column field="docType" header="Document Type" [style]="{'width':'25%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <div style="font-size:10px">{{dtNameCat(item)}}</div>
                  </ng-template>
                </p-column>
                <p-column field="" header="Document Name" [style]="{'width':'75%'}">
                  <ng-template pTemplate="body" let-item="rowData" styleClass="text-break">
                    <span>
                        <a href="{{baseURL + '/GetDocument?' + item.documentURL}}" target="_blank">{{item.documentName}}</a>

                      <!-- <a href="documents/{{item.documentName}}" (click)="doDocReq(item)">
                        {{item.documentName}}</a> -->
                    </span>
                    <div style="font-size:10px">{{baseURL + '/GetDocument?' + item.documentURL}}</div>
                  </ng-template>
                </p-column>
              </p-dataTable>
            </div>
          </div>
        </p-tabPanel>


        <!-- JUDICIAL ASSIGNMENTS TAB -->

        <p-tabPanel header="Judicial Assignments" leftIcon="ui-icon-assignment">
          <div class="ui-g">
            <div class="ui-g-12">
              <h2>Judicial Assignments</h2>
            </div>
            <div class="ui-g-12">
              <p-dataTable [value]="case.judicialAssignments" selectionMode="single"
                [(selection)]="selectedJudicialAssignment" (onRowSelect)="judicialAssignmentOnRowSelect($event)"
                scrollable="true" dataKey="judicialAssignmentOID" #dtJudicialAssignment>
                <p-column field="" header="Start Date/Time" [style]="{'width':'20%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{item.startDate | date:'dd-MMM-yyyy hh:mm a'}}
                  </ng-template>
                </p-column>
                <p-column field="" header="End Date/Time" [style]="{'width':'20%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{item.endDate | date:'dd-MMM-yyyy hh:mm a'}}
                  </ng-template>
                </p-column>
                <p-column field="" header="Assigned" [style]="{'width':'17%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    {{ item.judicialOfficial?.firstName + ' ' + item.judicialOfficial?.lastName }}
                  </ng-template>
                </p-column>
                <!-- <p-column styleClass="col-button" header="View" [style]="{'width':'7%'}">
                    <ng-template let-item="rowData" pTemplate="body">
                        <i class="material-icons" (click)="requestViewJudicialAssignment(item)">search</i>
                    </ng-template>
                </p-column> -->
              </p-dataTable>
            </div>
            <div class="ui-g-12">
              <button type="button" *ngIf="hasPermission(Permission.CREATE_JUDICIAL_ASSIGNMENT)" (click)="onAddJudge()"
                label="Add Judge" icon="ui-icon-add" class="ui-button-secondary mr-15" pButton></button>
            </div>
          </div>
        </p-tabPanel>
        
        <!-- HEARINGS TAB -->

        <p-tabPanel header="Hearings" leftIcon="ui-icon-gavel">
          <div class="ui-g">

            <!-- ------ HEARINGs COMPONENT -->
            <!-- <hearings [case]="case"></hearings> -->
            <app-temp-hearings [case]="case" (filteredEventsChange)="updateRegister($event)"></app-temp-hearings>

          </div>
        </p-tabPanel>

        <!-- MINUTES TAB -->

        <p-tabPanel header="Minutes" leftIcon="ui-icon-pencil">
          <div class="ui-g">

            <!-- ------ Minutes COMPONENT -->
            <app-minutes [case]="case"></app-minutes>

          </div>
        </p-tabPanel>




        <!-- PAYMENT & DISBURSEMENTS TAB -->
        <p-tabPanel header="Payments and Disbursements" leftIcon="ui-icon-list">
          
          <div class="ui-g">         
            <div class="ui-g-12">
              <h2>Payments & Disbursements</h2>
            </div>

            <div class="ui-g-12 ta-r mt-30">
              <button type="button"
                  *ngIf="hasPermission(Permission.CREATE_CASE)"
                  (click)="resetAddCasePaymentModal()"
                  label="Add Payment"
                  icon="ui-icon-add"
                  class="ui-button-secondary mr-15" pButton></button>
            </div>

            <div class="ui-g-12">
              <p-dataTable [value]="case.casePayments"
                          selectionMode="single"
                          [(selection)]="selectedCasePayment"
                          (onRowSelect)="ShowAddCasePayment($event)"
                          scrollable="true"
                          dataKey="paymentOID" #dtPayments>

                <p-column field="dateOfPayment" header="Date of Payment" [style]="{'width':'8%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.dateOfPayment | date:'dd-MMM-yyyy'}}
                  </ng-template>
                </p-column>

                <p-column field="receiptNumber" header="Receipt Number" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentMethod" header="Payment Method" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentType" header="Payment Type" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentNotes" header="Payment Notes" [style]="{'width':'14%'}" [sortable]="true"></p-column>

                <p-column field="" header="Name of Payor" [style]="{'width':'10%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                      <div *ngIf="item.payorParty?.partyOID">
                        {{ item.payorParty.fullName}}
                      </div>
                  </ng-template>
                </p-column>

                <p-column field="" header="Name of Beneficiary" [style]="{'width':'10%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                      <div *ngIf="item.beneficiaryParty?.partyOID">
                        {{ item.beneficiaryParty.firstName + ' ' + item.beneficiaryParty.lastName }}
                      </div>
                  </ng-template>
                </p-column>   
                
                <p-column field="" header="Payment In by Payor" [style]="{'width':'10%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      <div *ngIf="item.totalPaymentIn">
                        {{ '$'+ item.totalPaymentIn }}
                      </div>
                  </ng-template>
                </p-column>    
                

                <p-column field="" header="Payment Recorded By" [style]="{'width':'10%'}">
                    <ng-template pTemplate="body" let-item="rowData">
                        <div *ngIf="item.staffPartyRecordingPayment?.partyOID">
                          {{ item.staffPartyRecordingPayment.fullName}}
                        </div>
                    </ng-template>
                  </p-column>  
                  
                  <p-column field="" header="Payment Disbursed By" [style]="{'width':'10%'}" >
                      <ng-template pTemplate="body" let-item="rowData">
                          <div *ngIf="item.staffPartyRecordingDisbursement?.partyOID">
                            {{ item.staffPartyRecordingDisbursement.fullName}}
                          </div>
                      </ng-template>
                    </p-column>                      
              
                <p-column field="disbursementDate" header="Date of Disbursement" [style]="{'width':'8%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.disbursementDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
                </p-column>                
   
            </p-dataTable>

            </div>

            <div class="ui-g-12 ta-r mt-30">
              <button type="button"
                  *ngIf="hasPermission(Permission.CREATE_CASE)"
                  (click)="saveCase()"
                  label="Save Case"
                  icon="ui-icon-check"
                  class="btn-big" pButton
                  [disabled]="!caseForm.form.valid"></button>
            </div>


          </div>
        </p-tabPanel>      
        
    
        <!-- PAYMENT HISTORY -->
        <p-tabPanel header="Payment History" leftIcon="ui-icon-list">
          
          <div class="ui-g">         
            <div class="ui-g-12">
              <h2>Payment History</h2>
            </div>

            <div class="ui-g-12">
              <p-dataTable [value]="case.casePaymentsDetails"
                          scrollable="true"
                          dataKey="paymentDetailOID" #dtPaymentHistory>

                <p-column field="paymentDate" header="Date of Payment" [style]="{'width':'10%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.paymentDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
                </p-column>

                <p-column field="paymentPeriodStartDate" header="Period Start Date" [style]="{'width':'10%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.paymentPeriodStartDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
                </p-column>

                <p-column field="paymentPeriodEndDate" header="Period End Date" [style]="{'width':'10%'}" [sortable]="true">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.paymentPeriodEndDate | date:'dd-MMM-yyyy'}}
                  </ng-template>
                </p-column>

                <p-column field="receiptNumber" header="Receipt Number" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentType" header="Payment Type" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentItem" header="Payment Item" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentFrequency" header="Payment Frequency" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentAmountOrdered" header="Payment Amount Ordered" [style]="{'width':'10%'}" [sortable]="true"></p-column>
                <p-column field="paymentAmountIn" header="Customer Payment" [style]="{'width':'10%'}" [sortable]="true"></p-column>              
   
            </p-dataTable>

          </div>


          </div>
        </p-tabPanel>          


      </p-tabView>

    </div>
  </div>
  <!-- //END SECOND CARD - TAB SECTION -->

</div>





<!--
  ----------------------------------
  MODALS
  ----------------------------------
 -->

<!-- SAMPLE MODAL -->
<!-- <p-dialog header="Title"
           [(visible)]="showDetailsModal"
           [modal]="true"
           [draggable]="false"
           [positionLeft]="0"
           [positionTop]="0"
           [blockScroll]="true"
           [closable]="false">
 </p-dialog> -->


<!-- REMOVE CHARGE CONFIRMATION MODAL -->

<!-- <p-dialog header="Confirm Delete?" width="450" [(visible)]="showDeleteHearingModal" [responsive]="true" showEffect="fade" [modal]="true" [closable]="false">
    <div>Are you sure you want to delete this Hearing?</div>
    <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix">
            <button label="No" type="button" pButton icon="fa-close" (click)="hideModals()" ></button>
            <button label="Yes"   type="button" pButton icon="fa-check" (click)="deleteHearing()" ></button>
        </div>
    </p-footer>
</p-dialog> -->

<!-- REMOVE PARTY CONFIRMATION MODAL -->

<p-dialog header="Confirm Delete?" width="450" [(visible)]="showDeletePartyModal" [responsive]="true" showEffect="fade"
  [modal]="true" [closable]="false">
  <div>Are you sure you want to delete this Party?</div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button label="No" type="button" pButton icon="fa-close" (click)="hideModals()"></button>
      <button label="Yes" type="button" pButton icon="fa-check" (click)="deleteParty()"></button>
    </div>
  </p-footer>
</p-dialog>

<!-- ADD CASE PARTY MODAL -->

<p-dialog header="Add Case Party" styleClass="casePartyModal" width="700" [(visible)]="showModalAddCaseParty"
  [responsive]="true" showEffect="fade" [modal]="true" [closable]="false">

  <p-tabView>

    <!-- TAB 1 of ADD CASE PARTY
     ------------ ADD EXISTING PARTY ----------------
    -->
    <p-tabPanel header="Existing Party">
      <form #casePartyForm="ngForm" novalidate>
        <div class="ui-g">
          <div class="form-group">

            <div class="ui-g-12 ui-md-6">
              <div class="ui-inputgroup">
                <span class="md-inputfield">
                  <input type="text" [(ngModel)]="partySearchText" name="tiPartySearch" pInputText>
                  <label>Search party name</label>
                </span>
                <button pButton type="button" (click)="searchForParty()" icon="ui-icon-search"></button>
              </div>
            </div>

            <div class="ui-g-12">
              <p-dataTable [value]="searchPartyResults" selectionMode="single" [(selection)]="selectedSearchParty"
                scrollHeight="200px" [scrollable]="true" (onRowSelect)="searchPartyOnRowSelect($event)"
                dataKey="partyOID" #dtSearchParty>

                <p-column field="isOrganization" header="Is Org?" [style]="{'width':'8%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <i class="fa ui-icon-check task-done" *ngIf="item.isOrganization"></i>
                  </ng-template>
                </p-column>

                <p-column header="Party Info" [style]="{'width':'50%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                    <div>{{item.fullName?item.fullName:item.firstName+" "+item.lastName}}</div>
                    <!-- Christian: turned on when fullName support on Server -->
                    <!-- <div>{{ item.fullName }}</div> -->
                    <div *ngIf="!item.isOrganization">
                      <span class="smaller">
                        DOB: {{ item.dob | date:'dd-MMM-yy' }}
                        Sex: {{ item.sex }}
                        Age: {{ item.age }}
                      </span>
                    </div>
                  </ng-template>
                </p-column>

                <!-- <p-column header="Full Name" field="fullName" [style]="{'width':'50%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.fdob | date:'M/d/yyyy'}}
                  </ng-template>
                </p-column>

                <p-column header="First Name" field="firstName" [style]="{'width':'25%'}"></p-column>
                <p-column header="Last Name" field="lastName" [style]="{'width':'25%'}"></p-column>

                <p-column header="DOB" field="dob" [style]="{'width':'15%'}">
                  <ng-template pTemplate="body" let-item="rowData">
                      {{item.dob | date:'M/d/yyyy'}}
                  </ng-template>
                </p-column>
                <p-column header="Age" field="age" [style]="{'width':'10%'}"></p-column>
                <p-column header="Sex" field="sex" [style]="{'width':'7%'}"></p-column> -->

              </p-dataTable>
            </div>

            <div *ngIf="selectedSearchParty">
              <div class="ui-g-12 mb-0">
                <h3 class="mb-0">
                  {{selectedSearchParty.fullName?selectedSearchParty.fullName:selectedSearchParty.firstName+" "+selectedSearchParty.lastName}}
                </h3>
              </div>
              <div class="ui-g-12 mv-0">
                <label class="minimal primary block">Party Role</label>
                <p-dropdown name="ddPartyRole" id="ddPartyRole" #ddPartyRole="ngModel" placeholder="choose Party Role..."
                    [required]="true"
                    [options]="casePartyRoleTypes"
                    optionLabel="name"
                    [filter] = "true"
                    [(ngModel)]="selectedSearchPartyRole"
                    (onChange)="searchPartyRoleTypeOnChange($event)"
                    styleClass="width-full">
                </p-dropdown>
                <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="ddPartyRole.errors?.required && ddPartyRole.touched">
                  Party Role is required
                </div>
              </div>

              <div class="ui-g-12 mb-0 pl-0">
                <div class="ui-g-12 ui-md-6 mb-0">
                  <label class="minimal primary block">Start Date</label>
                  <p-calendar id="dtStartDate" name="dtStartDate" inputStyleClass="width-full"
                    [(ngModel)]="selectedSearchPartyStartDate" dateFormat="dd-M-yy" placeholder="Start Date"
                    [showIcon]="true" [yearNavigator]="true" yearRange="2000:2030" appendTo="body"
                    [required] = true></p-calendar>
                </div>
                <div class="ui-g-12 ui-md-6 mb-0">
                  <label class="minimal primary block">End Date</label>
                  <p-calendar id="dtEndDate" name="dtEndDate" inputStyleClass="width-full"
                    [(ngModel)]="selectedSearchPartyEndDate" dateFormat="dd-M-yy" placeholder="End Date"
                    [showIcon]="true" [yearNavigator]="true" yearRange="2000:2030" appendTo="body"></p-calendar>
                </div>
              </div>
            </div>
          </div>
        </div>
        <p-footer>
          <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30">
            <button label="Add Party To Case" type="submit" pButton icon="fa-check" (click)="addPartyToCase(caseForm)"
              [disabled]="!casePartyForm.form.valid || !selectedSearchParty"></button>
            <button label="Cancel" type="button" class="ui-button-secondary" pButton icon="fa-close"
              (click)="hideModals()"></button>
          </div>
        </p-footer>
      </form>
    </p-tabPanel>


    <!-- TAB 2 of ADD CASE PARTY
     ------------ CREATE NEW PARTY ----------------
    -->
    <p-tabPanel header="Create New Party">
      <form #newCasePartyForm="ngForm" novalidate class="mt-n-30">


        <div class="ui-g form-group" novalidate>

          <div *ngIf="newCaseParty">

            <div class="ui-g-12 mb-20 ml-10" *ngIf="newCaseParty.caseParty">
              <p-checkbox [(ngModel)]="newCaseParty.caseParty.isOrganization" binary="true" name="cb_isOrganization">
              </p-checkbox>
              <span class="task-name">Is Organization?</span>
            </div>

            <!-- Organization -->
            <div class="ui-g-12 ui-md-6" *ngIf="newCaseParty.caseParty?.isOrganization">
              <div class="ui-g-12 mb-20 pl-0">
                <span class="md-inputfield">
                  <input type="text" pInputText required [(ngModel)]="newCaseParty.caseParty.fullName" name="tiOrgName"
                    #tiOrgName="ngModel">
                  <label>Organization Name</label>
                </span>
              </div>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="tiOrgName.errors?.required && tiOrgName.touched">
                Please enter an Organization Name
              </div>
            </div>

            <div *ngIf="!newCaseParty.caseParty?.isOrganization">
              <div class="ui-g-12 mb-20">
                <span class="md-inputfield">
                  <input pInputText type="text" #newCPfName="ngModel" required name="newCPfName"
                    [ngModel]="newCaseParty.caseParty?.firstName" (ngModelChange)="newCPfNameChanged($event)">
                  <label>Given Name</label>
                </span>
                <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="newCPfName.errors?.required && newCPfName.touched">
                  Please enter Given Name
                </div>
              </div>

              <div class="ui-g-12 mb-20">
                <span class="md-inputfield">
                  <input type="text" pInputText #newCPlName="ngModel" name="newCPlName" required
                    [ngModel]="newCaseParty.caseParty?.lastName" (ngModelChange)="newCPlNameChanged($event)">
                  <label>Family Name</label>
                </span>
                <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="newCPlName.errors?.required && newCPlName.touched">
                  Please enter Family Name
                </div>
              </div>

              <div class="ui-g-12 mb-20">
                <span class="md-inputfield">
                  <input type="text" pInputText #newCPfullName="ngModel" name="newCPfullName"
                    [ngModel]="newCaseParty.caseParty?.fullName" (ngModelChange)="newCPlFullNameChanged($event)">
                  <label>Full Name</label>
                </span>
                <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="newCPfullName.errors?.required && newCPfullName.touched">
                  Please enter Full Name
                </div>
              </div>

              <div class="ui-g-12 mb-0">
                <span class="md-inputfield">
                  <input type="text" pInputText name="newCPaltName" [ngModel]="newCaseParty.caseParty?.alternativeName"
                    (ngModelChange)="newCPaltNameChanged($event)">
                  <label>Alternative Name</label>
                </span>
              </div>

              <div class="ui-g-12 mb-0 pl-0">
                <div class="ui-g-12 ui-md-6 mb-0">
                  <label class="minimal primary block">Date of Birth</label>
                  <p-calendar id="newCPdob" name="newCPdob" #newCPdob="ngModel" [required]="true"
                    inputStyleClass="width-full" [ngModel]="newCaseParty.caseParty?.dob"
                    (ngModelChange)="newCPdobChange($event)" dateFormat="dd-M-yy" placeholder="Date of Birth"
                    [showIcon]="true" [yearNavigator]="true" yearRange="1900:2020" appendTo="body"></p-calendar>
                  <div class="ui-message ui-messages-error ui-corner-all"
                    *ngIf="newCPdob.errors?.required && newCPdob.touched">
                    Please enter a Date of Birth
                  </div>
                </div>

                <div class="ui-g-12 ui-md-6 mb-0">
                  <label class="minimal primary block">Sex</label>
                  <p-dropdown name="newCPsex" #newCPsex="ngModel" placeholder="choose gender" [required]="true"
                    [options]="genderTypes" [ngModel]="newCaseParty.caseParty?.sex"
                    (ngModelChange)="newCPsexChange($event)" styleClass="width-auto">
                  </p-dropdown>
                  <div class="ui-message ui-messages-error ui-corner-all"
                    *ngIf="newCPsex.errors?.required && newCPsex.touched">
                    Please enter a gender
                  </div>
                </div>
              </div>
            </div>

            <div class="ui-g-12 mb-0">
              <label class="minimal primary block">Party Role</label>
              <p-dropdown name="ddNewPartyRole" #ddNewPartyRole="ngModel" placeholder="choose Party Role..."
                [required]="true" [options]="casePartyRoleTypes" optionLabel="name" [(ngModel)]="newCaseParty.role"
                (onChange)="newCasePartyRoleTypeOnChange($event)" styleClass="width-full"
                [filter] = "true">
              </p-dropdown>
              <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="ddNewPartyRole.errors?.required && ddNewPartyRole.touched">
                Party Role is required
              </div>
            </div>

            <!-- column 3 -->
            <div class="ui-g-12 mb-0 pl-0">
              <div class="ui-g-12 ui-md-6 mb-0">
                <label class="minimal primary block">Start Date</label>
                <p-calendar id="dtStartDate" name="dtStartDate" inputStyleClass="width-full"
                  [(ngModel)]="newCaseParty.startDate" dateFormat="dd-M-yy" placeholder="Start Date" [showIcon]="true"
                  [yearNavigator]="true" yearRange="2000:2030" appendTo="body"
                  [required]="true"></p-calendar>
              </div>
              <div class="ui-g-12 ui-md-6 mb-0">
                <label class="minimal primary block">End Date</label>
                <p-calendar id="dtEndDate" name="dtEndDate" inputStyleClass="width-full"
                  [(ngModel)]="newCaseParty.endDate" dateFormat="dd-M-yy" placeholder="End Date" [showIcon]="true"
                  [yearNavigator]="true" yearRange="2000:2030" appendTo="body"></p-calendar>
              </div>
            </div>
          </div>
        </div>
        <p-footer>
          <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30 ta-r">
            <button label="Create and Add Party To Case" type="submit" pButton icon="fa-check"
              (click)="createAndAddPartyToCase(caseForm)"
              [disabled]="!newCasePartyForm.form.valid || !newCaseParty"></button>
            <button label="Cancel" type="button" class="ui-button-secondary mr-15" pButton icon="fa-close"
              (click)="hideModals()"></button>
          </div>
        </p-footer>

      </form>
    </p-tabPanel>

  </p-tabView>
</p-dialog>

<!-- DIALOG CASE PARTY
  ------------ EDIT PARTY ----------------
-->
<p-dialog header="Edit Party" width="450" [(visible)]="showModalEditCaseParty" [responsive]="true" showEffect="fade"
  [modal]="true" [closable]="false">
  <form #editCasePartyForm="ngForm" novalidate>
    <div class="ui-g form-group" novalidate>


      <!--div *ngIf="selectedCaseParty.isOrganization">
             <div class="ui-g-12 mb-20 pl-0" >
                <span class="md-inputfield">
                  <input type="text" pInputText required
                          [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                          [(ngModel)]="selectedCaseParty.fullName" name="tiOrgName" #tiOrgName="ngModel" >
                  <label>Organization Name</label>
                </span>
              </div>
              <div class="ui-message ui-messages-error ui-corner-all"
                   *ngIf="tiOrgName.errors?.required && tiOrgName.touched" >
                    Please enter the Organization Name
              </div>
            </div-->


      <div *ngIf="selectedCaseParty">

        <div class="ui-g-12 mb-20">
          <span class="md-inputfield">
            <input pInputText type="text" #editCPfName="ngModel" required name="editCPfName" [disabled]="true"
              [ngModel]="selectedCaseParty.caseParty?.firstName" (ngModelChange)="editCPfNameChanged($event)">
            <label>First Name</label>
          </span>
          <div class="ui-message ui-messages-error ui-corner-all"
            *ngIf="editCPfName.errors?.required && editCPfName.touched">
            Please enter First Name
          </div>
        </div>

        <div class="ui-g-12 mb-20">
          <span class="md-inputfield">
            <input type="text" pInputText #editCPlName="ngModel" name="editCPlName" required [disabled]="true"
              [ngModel]="selectedCaseParty.caseParty?.lastName" (ngModelChange)="editCPlNameChanged($event)">
            <label>Last Name</label>
          </span>
          <div class="ui-message ui-messages-error ui-corner-all"
            *ngIf="editCPlName.errors?.required && editCPlName.touched">
            Please enter Last Name
          </div>
        </div>

        <div class="ui-g-12 mb-0">
          <span class="md-inputfield">
            <input type="text" pInputText name="editCPaltName" [disabled]="true"
              [ngModel]="selectedCaseParty.caseParty?.alternativeName" (ngModelChange)="editCPaltNameChanged($event)">
            <label>Alternative Name</label>
          </span>
        </div>


        <div class="ui-g-12 mb-0 pl-0">
          <div class="ui-g-12 ui-md-6 mb-0">
            <label class="minimal primary block">Date of Birth</label>
            <p-calendar id="editCPdob" name="editCPdob" #editCPdob="ngModel" [disabled]="true" [required]="true"
              inputStyleClass="width-full" [ngModel]="selectedCaseParty.caseParty?.dob"
              (ngModelChange)="editCPdobChange($event)" dateFormat="dd-M-yy" placeholder="Date of Birth"
              [showIcon]="true" [yearNavigator]="true" yearRange="1900:2020" appendTo="body"></p-calendar>
            <div class="ui-message ui-messages-error ui-corner-all"
              *ngIf="editCPdob.errors?.required && editCPdob.touched">
              Please enter a Date of Birth
            </div>
          </div>

          <div class="ui-g-12 ui-md-6 mb-0">
            <label class="minimal primary block">Sex</label>
            <p-dropdown name="editCPsex" #editCPsex="ngModel" placeholder="choose gender" [disabled]="true"
              [required]="true" [options]="genderTypes" [ngModel]="selectedCaseParty.caseParty?.sex"
              (ngModelChange)="editCPsexChange($event)" styleClass="width-auto">
            </p-dropdown>
            <div class="ui-message ui-messages-error ui-corner-all"
              *ngIf="editCPsex.errors?.required && editCPsex.touched">
              Please enter a gender
            </div>
          </div>
        </div>

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Party Role</label>
          <p-dropdown name="ddNewPartyRole" #ddNewPartyRole="ngModel" placeholder="choose Party Role..."
            [disabled]="true" [required]="true" [options]="casePartyRoleTypes" optionLabel="name"
            [(ngModel)]="selectedCaseParty.role" (onChange)="editCasePartyRoleTypeOnChange($event)"
            styleClass="width-full">
          </p-dropdown>
          <div class="ui-message ui-messages-error ui-corner-all"
            *ngIf="ddNewPartyRole.errors?.required && ddNewPartyRole.touched">
            Party Role is required
          </div>
        </div>

        <!-- column 3 -->
        <div class="ui-g-12 mb-0 pl-0">
          <div class="ui-g-12 ui-md-6 mb-0">
            <label class="minimal primary block">Start Date</label>
            <p-calendar id="dtStartDate" name="dtStartDate" [disabled]="true" inputStyleClass="width-full"
              [(ngModel)]="selectedCaseParty.startDate" dateFormat="dd-M-yy" placeholder="Start Date" [showIcon]="true"
              [yearNavigator]="true" yearRange="2000:2030" appendTo="body"></p-calendar>
          </div>
          <div class="ui-g-12 ui-md-6 mb-0">
            <label class="minimal primary block">End Date</label>
            <p-calendar id="dtEndDate" name="dtEndDate" inputStyleClass="width-full"
              [(ngModel)]="selectedCaseParty.endDate" dateFormat="dd-M-yy" placeholder="End Date" [showIcon]="true"
              [yearNavigator]="true" yearRange="2000:2030" appendTo="body"></p-calendar>
          </div>
        </div>
      </div>
    </div>
    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30 ta-r">
        <button label="Edit Party" type="submit" pButton icon="fa-check" (click)="editParty()"
          [disabled]="!editCasePartyForm.form.valid || !selectedCaseParty"></button>
        <button label="Cancel" type="button" class="ui-button-secondary mr-15" pButton icon="fa-close"
          (click)="hideModals()"></button>
      </div>
    </p-footer>

  </form>

</p-dialog>

<!-- START: ADD CASE APPLICATION MODAL -->

<p-dialog header="Case Application Details" styleClass="caseApplicationModal" width="1200" [(visible)]="showModalAddCaseApplication" [responsive]="true" showEffect="fade" [modal]="true" [closable]="false">
  
  <form #caseApplicationForm="ngForm" *ngIf="showModalAddCaseApplication">
    <div class="ui-g">
      <div class="form-group" >

        <div class="ui-g-12">
          
          <div class="ui-g-12 ui-md-3" *ngIf="case.caseNumber != 0">
            <label class="minimal primary block">Case Number</label>
            <div class="mar-0">{{case.caseNumber}}</div>
          </div>

           <div class="ui-g-12 ui-md-3" *ngIf="selectedCaseApplication.caseApplicationOID != 0">
              <label class="minimal primary block">Application Number</label>
              <div class="mar-0">{{selectedCaseApplication.caseApplicationNumber}}</div>
           </div>
            
            <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Application Type</label>
              <p-dropdown name="ddApplicationType" id="ddApplicationType"  placeholder="Choose Application Type"
                  [required]="true"
                  [options]="caseApplicationTypes"
                  optionLabel="name"
                  [disabled]="(!hasPermission(Permission.CREATE_TASK) && selectedCaseApplication.caseApplicationOID > 0) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                  [filter] = "true"
                  [(ngModel)]="selectedCaseApplication.caseApplicationObjType"
                  (onChange)="applicationTypeOnChange($event)"
                  styleClass="width-full">
              </p-dropdown>             
            </div>  
            
            <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Application Status</label>
              <p-dropdown name="ddApplicationStatus" id="ddApplicationStatus" placeholder="Choose Application Status"
                  [required]="true"
                  [options]="applicationStatus"
                  filter = "true"
                  [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                  [ngModel]="selectedCaseApplication.caseApplicationStatus"
                  appendTo="body"
                  (onChange)="applicationStatusOnChange($event)"
                  styleClass="width-full">
              </p-dropdown>
           </div>    
        </div>

        <div class="ui-g-12">
           <div class="ui-g-12 ui-md-4">
              <label class="minimal primary block">Start Date</label>
              <p-calendar id="dtAppStartDate" name="dtAppStartDate" placeholder="Start Date"                      
                    (ngModelChange) ="caseApplicationStartDateOnChange($event)"
                    [ngModel]="selectedCaseApplication?.caseApplicationStartDate"
                    [required]="true"
                    appendTo="body"
                    [inline] = "false"
                    dateFormat="dd-M-yy"  
                    [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"                  
                    [showIcon]="true"
                    [monthNavigator]="true" 
                    [yearNavigator]="true"
                    yearRange="2000:2030"
                    appendTo="body">
              </p-calendar>
           </div>
    
          <div class="ui-g-12 ui-md-4">
            <label class="minimal primary block">End Date</label>
            <p-calendar id="dtAppEndDate" name="dtAppEndDate" placeholder="Application End Date"                      
                    (ngModelChange) ="caseApplicationEndDateOnChange($event)"
                    [ngModel]="selectedCaseApplication?.caseApplicationEndDate"
                    [required]="false"
                    appendTo="body"
                    [inline] = "false"
                    dateFormat="dd-M-yy"  
                    [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"                  
                    [showIcon]="true"
                    [monthNavigator]="true" 
                    [yearNavigator]="true"
                    yearRange="2000:2030"
                    appendTo="body">
              </p-calendar>
          </div>   

       </div>

       <div class="ui-g-12">     
         
          <div class="ui-g-12">
              <header class="mb-10" *ngIf="selectedCaseApplication.caseApplicationType == 1">Marriage Details</header>
          </div>

          <!-- CAPTURE THE PLACE OF MARRIAGE  -->
          <div class="ui-g-12 ui-md-4" *ngIf="selectedCaseApplication.caseApplicationType == 1">             
              <label class="minimal primary block">Date of Marriage</label>
              <p-calendar id="dtOfMarriage" name="dtOfMarriage" placeholder="Date of Marriage"                      
                      (ngModelChange) ="dateOfMarriageOnChange($event)"
                      [ngModel]="selectedCaseApplication?.dateOfMarriage"
                      [required]="true"
                      appendTo="body"
                      [inline] = "false"
                      dateFormat="dd-M-yy"   
                      [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"                  
                      [showIcon]="true"
                      [monthNavigator]="true" 
                      [yearNavigator]="true"
                      yearRange="2000:2030"
                      appendTo="body">
                </p-calendar>
           </div>          
                        
            <div class="ui-g-12 ui-md-4" *ngIf="selectedCaseApplication.caseApplicationType == 1">                    
                  <label class="minimal primary block">Country of Marriage</label>
                  <p-dropdown name="ddAomCountry" id="ddAomCountry" #ddAomCountry="ngModel" 
                    placeholder="Choose Country of Marriage"
                    [required] = "true"
                    [filter] = "true"
                    [(ngModel)]="selectedCaseApplication.aomCountryName"
                    [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)" 
                    [options]="countries"                    
                    [style]="{'width':'100%'}"
                    (onChange)="countryOfMarriageOnChange($event)">
                  </p-dropdown>
              </div>

              <div class="ui-g-12 ui-md-4" *ngIf="selectedCaseApplication.caseApplicationType == 1">     
                  <label class="minimal primary block">Street Address</label>   
                  <span class="md-inputfield">
                    <input type="text" pInputText #martialStreetAddress="ngModel" name="martialStreetAddress" 
                            [required] = "true"                            
                            [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)" 
                            [ngModel]="selectedCaseApplication.aomStreetName"  
                            (ngModelChange)="editStreetAddressOnChange($event)">
                  </span>
                    <div class="ui-message ui-messages-error ui-corner-all"
                          *ngIf="martialStreetAddress.errors?.required && martialStreetAddress.touched" >
                          Please enter the street address for place of marriage
                    </div>
                    </div>              
        </div>

        <div class="ui-g-12"> 

            <div class="ui-g-12 ui-md-4" *ngIf="selectedCaseApplication.caseApplicationType == 1">  
                <label class="minimal primary block">City</label>        
                <span class="md-inputfield">
                <input type="text" pInputText #martialCityAddress="ngModel" name="martialCityAddress" 
                      [required] = "true"
                      [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)" 
                      [ngModel]="selectedCaseApplication.aomCityName"  
                      (ngModelChange)="editCityAddressOnChange($event)">
                </span>
                    <div class="ui-message ui-messages-error ui-corner-all"
                      *ngIf="martialCityAddress.errors?.required && martialCityAddress.touched" >
                      Please enter the city / towm for place of marriage
                    </div>
              </div>   
              
              <div class="ui-g-12 ui-md-4" *ngIf="selectedCaseApplication.caseApplicationType == 1">  
                  <label class="minimal primary block">Community Code</label>        
                  <span class="md-inputfield">
                  <input type="text" pInputText #communityCode="ngModel" name="communityCode" 
                        [required] = "false"
                        [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)" 
                        [ngModel]="selectedCaseApplication.communityCode"  
                        (ngModelChange)="communityCodeOnChange($event)">
                  </span>
                      <div class="ui-message ui-messages-error ui-corner-all"
                        *ngIf="communityCode.errors?.required && communityCode.touched" >
                        Please enter the Community Code
                      </div>
                </div>  

                <div class="ui-g-12 ui-md-4" *ngIf="selectedCaseApplication.caseApplicationType == 1">  
                    <label class="minimal primary block">Administrative Area Code</label>        
                    <span class="md-inputfield">
                    <input type="text" pInputText #administrativeAreaCode="ngModel" name="administrativeAreaCode" 
                          [required] = "false"
                          [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)" 
                          [ngModel]="selectedCaseApplication.administrativeAreaCode"  
                          (ngModelChange)="administrativeAreaCodeOnChange($event)">
                    </span>
                        <div class="ui-message ui-messages-error ui-corner-all"
                          *ngIf="administrativeAreaCode.errors?.required && administrativeAreaCode.touched" >
                          Please enter the Administrative Area Code
                        </div>
                  </div>  
        </div>

       

        <!-- ADD PARTY APPLICANT & PARTY ROLES SECTION  -->

        <div class="ui-g-12 mt-0">
          <div class="ui-g-12">
            <header class="mb-10">Party Applicant &amp; Party Roles</header>
          </div>

          <div class="ui-g-12 mb-5 partyNames-th">
            <div class="ui-g-5 pv-0">
              <label class="minimal primary block">Party Name</label>
            </div>
            <div class="ui-g-6 pv-0">
              <label class="minimal primary block">Party Role</label>
            </div>
          </div>

          <div class="ui-g-12 mb-5 caseapplicant-row" *ngFor="let caseapplicant of selectedCaseApplication.caseApplicants; let acIdx = index">
            
            <div class="ui-g-5 ph-20 pv-5">
              <mat-form-field class="width-full" >
                  <mat-select name="ddCPName"
                    [value]="caseapplicant"
                    [compareWith]="compareByCasePartyId"
                    [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                    (selectionChange)="caseApplicantOnChange($event, acIdx)">
                 <mat-option *ngFor="let caName of appCaseParties" [value]="caName">
                    {{caName.fullName}}
                  </mat-option>
             
                </mat-select>
              </mat-form-field>
            </div>

            <div class="ui-g-5 ph-20 pv-5">
               <mat-form-field class="width-full" >
                   <mat-select name="ddCPRole"
                      [value]="caseapplicant"
                      [compareWith]="compareByCasePartyRoleId"
                      [disabled]="!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                      (selectionChange)="caseApplicantRoleOnChange($event, acIdx)" >                 
                    <mat-option *ngFor="let roleTypes of casePartyRoleTypes" [value]="roleTypes">
                      {{roleTypes.name}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
            </div>

            <div class="ui-g-1 ta-r mt-15 ph-20 pv-5">
              <i class="material-icons delete-icon" (click)="requestDeleteCasePartyApplicant(acIdx)">delete</i>
            </div>
        </div>
     </div>
     </div>
    </div>

    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30">
        
               
        <button label="Cancel" type="button" class="ui-button-secondary" pButton icon="fa-close"
                (click)="hideModals()" >
        </button>
        <button label="Save Application Details" type="submit" pButton icon="fa-check"
                (click)="addCaseApplication()"
                [disabled]="!caseApplicationForm.form.valid">
        </button> 
        <button type="button" (click)="addCaseApplicant();" label="Add Applicant &amp; Role"
                icon="ui-icon-add" class="ui-button-secondary mr-15"
                pButton>
        </button>
      </div>
    </p-footer>    
  </form>
</p-dialog>

<!-- END: ADD CASE APPLICATION MODAL -->


<!-- ADD CASE CHARGE MODAL -->

<p-dialog header="Add Case Charge" width="80%" [(visible)]="showModalAddCaseCharge" [responsive]="true"
  showEffect="fade" [modal]="true" [closable]="false">
  <form #caseChargeForm="ngForm" novalidate>
    <!-- (ngSubmit)="saveCaseCharge()" -->
    <div class="ui-g">
      <div class="form-group">

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Section</label>
          <span *ngIf="selectedChargeLawType && selectedSectionType">{{selectedSectionType.categoryName}}</span>
          <span *ngIf="selectedChargeLawType && !selectedSectionType">Not Applicable</span>
          <span class="text-muted" *ngIf="!selectedChargeLawType">Unknown</span>
        </div>

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Division</label>
          <span *ngIf="selectedChargeLawType && selectedDivisionType">{{selectedDivisionType.categoryName}}</span>
          <span *ngIf="selectedChargeLawType && !selectedDivisionType">Not Applicable</span>
          <span class="text-muted" *ngIf="!selectedChargeLawType">Unknown</span>
        </div>

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Group</label>
          <span *ngIf="selectedChargeLawType && selectedGroupType">{{selectedGroupType.categoryName}}</span>
          <span *ngIf="selectedChargeLawType && !selectedGroupType">Not Applicable</span>
          <span class="text-muted" *ngIf="!selectedChargeLawType">Unknown</span>
        </div>

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Class</label>
          <span *ngIf="selectedChargeLawType && selectedClassType">{{selectedClassType.categoryName}}</span>
          <span *ngIf="selectedChargeLawType && !selectedClassType">Not Applicable</span>
          <span class="text-muted" *ngIf="!selectedChargeLawType">Unknown</span>
        </div>

        <div class="ui-g-12 mb-0 feature-box">
          <p>Enter Charge</p>
          <div class="feature-box-inner">
            <label class="minimal primary block">Charge</label>
            <custom-autocomplete name="ddChargeLaw" id="ddChargeLaw" #ddChargeLaw="ngModel"
              placeholder="choose Charge..." [required]="true" [options]="chargeLawTypes" labelField="localCharge"
              dataField="localChargeOID" [ngModel]="selectedChargeLawType?.localChargeOID"
              (ngModelChange)="chargeLawTypeOnChange($event)" [filterFunction]="localChargeFilterFunction"
              [labelFunction]="localChargeLabelFunction" styleClass="width-full">
              <ng-template let-option>
                <div class="custom-ac-label1">
                  {{option.categoryIdentifier}} {{option.localCharge}}
                </div>
                <div class="custom-ac-label2">
                  {{option.localLaw}}
                </div>
              </ng-template>
            </custom-autocomplete>
            <div class="custom-ac-label2" *ngIf="selectedChargeLawType">
              {{selectedChargeLawType?.localLaw}}
            </div>
            <div class="ui-message ui-messages-error ui-corner-all"
              *ngIf="ddChargeLaw.errors?.required && ddChargeLaw.touched">
              Charge/Law is required
            </div>
          </div>
        </div>

        <div class="ui-g-12">
          <label class="minimal primary block" for="tiLea">Police Description</label>
          <textarea id="tiLea" name="tiLea" #tiLea="ngModel" [required]="true" [(ngModel)]="leaLeadChargeText"
            [rows]="2" pInputTextarea autoResize="autoResize" class="width-full"></textarea>
          <div class="ui-message ui-messages-error ui-corner-all" *ngIf="tiLea.errors?.required && tiLea.touched">
            Police Description is required
          </div>
        </div>

        <!--Rhea Seegobin Implemented 3 tier filtering without constant server calls-->

        <!--div class="ui-g-12 ">
            <div class="ui-g-3 ph-20 pv-5">
            <label class="minimal primary block">Charge Factor Category</label>
            <span class="ui-fluid">
              <p-autoComplete name="acChargeFactorCategory" #acChargeFactorCategory="ngModel"
                  [required]="true"
                  field="chargeFactorCategoryDesc"
                  [(ngModel)]="selectedChargeFactorCategory"
                  [suggestions]="filteredChargeFactorCategory"
                  (completeMethod)="getChargeFactorCategoryToFilter($event)"
                  styleClass="width-full"
                  [minLength]="1"
                  placeholder="Please Select a Charge Factor Category"
                  [dropdown]="true"
                  appendTo="body"
                  [multiple]="false">
              </p-autoComplete>
            </span>
            <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="acChargeFactorCategory.errors?.required && acChargeFactorCategory.touched" >
                  One or more Charge Factor Category is required.
            </div>
          </div>

          <div class="ui-g-4 ph-20 pv-5">
          <label class="minimal primary block">Charge Factor</label>
          <span class="ui-fluid">
            <p-autoComplete name="acChargeFactors" #acChargeFactors="ngModel"
                [required]="true"
                field="description"
                [(ngModel)]="selectedChargeFactors"
                [suggestions]="filteredChargeFactorTypes"
                (completeMethod)="getChargeFactorsToFilter($event,selectedChargeFactorCategory)"
                styleClass="width-full"
                [minLength]="1"
                placeholder="Please select a Charge Factor"
                [dropdown]="true"
                appendTo="body"
                [multiple]="false">
            </p-autoComplete>
          </span>
          <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="acChargeFactors.errors?.required && acChargeFactors.touched" >
                One or more Charge Factors are required.
          </div>
        </div>

        <!(completeMethod)="getChargeFactorsVariablesToFilter($event)" Taken out by RS>
        <div class="ui-g-4 ph-20 pv-5">
            <label class="minimal primary block">Charge Factor Variable</label>
            <span class="ui-fluid">
              <p-autoComplete name="acChargeFactorVariable" #acChargeFactorVariable="ngModel"
                  [required]="true"
                  field="chargeFactorVariableDesc"
                  (completeMethod)= "getChargeFactorsVariablesToFilter($event,selectedChargeFactors)"
                  [(ngModel)]="selectedChargeFactorVariables"
                  [suggestions]="filteredChargeFactorVariables"
                  styleClass="width-full"
                  [minLength]="1"
                  placeholder="Please Select a Charge Factor Variable"
                  [dropdown]="true"
                  appendTo="body"
                  [multiple]="false">
              </p-autoComplete>
            </span>
            <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="acChargeFactorVariable.errors?.required && acChargeFactorVariable.touched" >
                  One or more Charge Factor Variables are required.
            </div>
          </div>

          <div class="ui-g-1 ta-r mt-15 ph-20 pv-5">
              <i class="material-icons delete-icon" (click)="requestDeleteAuthCourt(acIdx)">delete</i>
            </div>



        </div-->


      </div>
    </div>

    <p-footer>

      <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30">

        <!--button type="button" (click)="addChargeFactorDetails();" label="Add Additional Charge Factor Variables"
            icon="ui-icon-add" class="ui-button-secondary mr-15"
            pButton></button-->

        <button label="Save" type="submit" pButton icon="fa-check" (click)="saveCaseCharge()"
          [disabled]="!caseChargeForm.form.valid"></button>

        <button label="Cancel" class="ui-button-secondary" type="button" pButton icon="fa-close"
          (click)="hideModals()"></button>

        <!--Add button to add multiple charge factors-->
      </div>
    </p-footer>

  </form>
</p-dialog>



<!-- ADD CASE TASK MODAL -->

<p-dialog header="Case Task Details" width="450" [(visible)]="showModalAddCaseTask" [responsive]="true"
  showEffect="fade" [modal]="true" [closable]="false">
  <loading-bar [visible]="loadingCaseTaskLookups" [message]="'loading task data...'"></loading-bar>

  <form (ngSubmit)="saveCaseTask()" #caseTaskForm="ngForm" novalidate>
    <div class="ui-g">
      <div class="form-group">

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Task Type</label>
          <p-dropdown name="ddTaskType" id="ddTaskType" #ddTaskType="ngModel" placeholder="choose Task Type..."
            [required]="true" [options]="taskTypes" optionLabel="name" [ngModel]="selectedCaseTask?.taskType"
            [filter]="true"
            [disabled]="!hasPermission(Permission.CREATE_TASK) || selectedCaseTask?.taskDoneDate != null"
            (onChange)="taskTypeOnChange($event)" styleClass="width-full">
          </p-dropdown>
          <div class="ui-message ui-messages-error ui-corner-all"
            *ngIf="ddTaskType.errors?.required && ddTaskType.touched">
            Task Type is required
          </div>
        </div>

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Priority</label>
          <p-dropdown name="ddPriority" id="ddPriority" placeholder="choose Priority..."
            [options]="caseTaskPriorityTypes" [ngModel]="selectedCaseTask?.taskPriorityCode"
            [disabled]="!hasPermission(Permission.CREATE_TASK) || selectedCaseTask?.taskDoneDate != null"
            (onChange)="priorityTypeOnChange($event)" styleClass="width-full">
          </p-dropdown>
        </div>

        <div class="ui-g-12">
          <label class="minimal primary block" for="tiTaskDetails">Task Details</label>
          <textarea id="tiTaskDetails" name="tiTaskDetails" placeholder="Please Enter Task Details if needed"
            [ngModel]="selectedCaseTask?.taskDetails" (ngModelChange)="taskDetailsOnChange($event)"
            [disabled]="!hasPermission(Permission.UPDATE_TASK) || selectedCaseTask?.taskDoneDate != null" [rows]="2"
            pInputTextarea autoResize="autoResize" styleClass="width-full"></textarea>
        </div>

        <div class="ui-g-12 mb-0">
          <label class="minimal primary block">Document Template</label>
          <p-dropdown name="ddDocTemplate" id="ddDocTemplate" #ddDocTemplate
            placeholder="Please select a document template if required" [filter]="true"
            [options]="documentTemplateTypes" optionLabel="documentName" [ngModel]="selectedCaseTask?.docTemplate"
            (onChange)="taskdocumentSelectedOnChange($event)"
            [disabled]="!hasPermission(Permission.CREATE_TASK) || selectedCaseTask?.taskDoneDate != null"
            styleClass="width-full">
          </p-dropdown>
        </div>


        <div class="ui-g-12 mb-0">
              <label class="minimal primary block">Assigned Staff Pool</label>
              <p-dropdown name="ddStaffPool" placeholder="choose Staff Pool..."
                  [options]="staffPools"
                  optionLabel="poolName"
                  [ngModel]="selectedCaseTask?.assignedPool"
                  [filter]="true"
                  [disabled]="!hasPermission(Permission.CREATE_TASK) || selectedCaseTask?.taskDoneDate != null"
                  (onChange)="staffPoolTypeOnChange($event)"
                  styleClass="width-full">
              </p-dropdown>
            </div>
    
            <div class="ui-g-12 mb-0">
               <label class="minimal primary block">Due Date and Expected Completion Time</label>
               <p-calendar id="ExpectedCompletionTime" name="ExpectedCompletionTime" placeholder="Enter Date and Time"
                   [ngModel]="selectedCaseTask?.taskDueDate"
                   (ngModelChange)="dueDateOnChange($event)"
                   [showIcon]="true"
                   appendTo="body"
                   [inline]="false"
                   [showTime]="true"
                   [hourFormat]="12" 
                   [disabled]="!hasPermission(Permission.CREATE_TASK) || selectedCaseTask?.taskDoneDate != null"
                   dateTimeFormat="dd-M-yy HH-mm a"
                   [monthNavigator]="true" 
                   [yearNavigator]="true" 
                   yearRange="2000:2030">
               </p-calendar>
            </div>     

        <div class="ui-g-12 mb-0" *ngIf="selectedCaseTask?.taskOID != 0">
          <label class="minimal primary block">Task Checked Out?</label>
          <p-checkbox [ngModel]="selectedCaseTask?.taskCheckedOut" binary="true" name="taskCheckedOut"
            (onChange)="taskCheckedOutOnChange($event)"
            [disabled]="(!hasPermission(Permission.CREATE_TASK) && selectedCaseTask?.taskCheckedOutBy == 1) || selectedCaseTask?.taskDoneDate != null">
          </p-checkbox>
          <span class="task-name">Task Checked Out?</span>
        </div>

        <div class="ui-g-12 mb-0" *ngIf="selectedCaseTask?.taskOID != 0">
          <label class="minimal primary block">Task Completed?</label>
          <p-checkbox [ngModel]="selectedCaseTask?.taskCompleted" binary="true" name="taskCompleted"
            (onChange)="taskCompletedOnChange($event)" [disabled]="selectedCaseTask?.taskDoneDate != null">
          </p-checkbox>
          <span class="task-name">Task Completed?</span>
        </div>

      </div>
    </div>

    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30">
        <button label="Save Task" type="submit" pButton icon="fa-check" [disabled]="!caseTaskForm.form.valid"></button>
        <button label="Cancel" class="ui-button-secondary" type="button" pButton icon="fa-close"
          (click)="onCancelCaseTask(caseTaskForm)"></button>
      </div>
    </p-footer>

  </form>
</p-dialog>


<!-- ADD PAYMENTS & DISBURSEMENTS MODAL -->

  <p-dialog header="Payment & Disbursement Details for Case Number {{case?.caseNumber}}" width="1200" [(visible)]="showModalAddCasePayment" [responsive]="true" showEffect="fade" [modal]="true" [closable]="false">

  <form (ngSubmit)="addCasePayment()" #casePaymentForm="ngForm" *ngIf="showModalAddCasePayment">
    <div class="ui-g">
      <div class="form-group" >  
        
        
        <div class="ui-g-12">

          <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block">Date of Payment</label>
            <p-calendar id="dateOfPayment" name="dateOfPayment" placeholder="Payment Date"
                [ngModel]="selectedCasePayment.dateOfPayment"
                (ngModelChange)="dateOfPaymentOnChange($event)"
                [showIcon]="true"
                appendTo="body"
                [inline]="false"
                [required]="true"                      
                dateFormat="dd-M-yy"
                [disabled]="((selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)))"
                [monthNavigator]="true" 
                [yearNavigator]="true" 
                yearRange="2000:2030"
                styleClass="width-full">
            </p-calendar>
          </div>
        

        <div class="ui-g-12 ui-md-3">
            <label class="minimal primary block">Payment Method</label>
            <p-dropdown name="paymentMethod" id="paymentMethod" placeholder="Choose Payment Item"
                      [required]="true"
                      [options]="paymentMethod"
                      filter = "true"
                      [ngModel]="selectedCasePayment.paymentMethod"
                      [disabled]="((selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)))"
                      appendTo="body"
                      (onChange)="paymentMethodOnChange($event)"
                      styleClass="width-full">
            </p-dropdown>
            <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="paymentMethod.errors?.required && paymentMethod.touched" >
                  A payment Method is required
            </div>
        </div>

        <div class="ui-g-12 ui-md-3">
            <label class="minimal primary block">Payment Type</label>
            <p-dropdown name="paymentType" id="paymentType" placeholder="Choose Payment Type"
                      [required]="true"
                      [options]="paymentTypes"
                      filter = "true"
                      [ngModel]="selectedCasePayment.paymentType"
                      [disabled]="(selectedCasePayment?.paymentOID != 0 && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                      appendTo="body"
                      (onChange)="paymentTypeOnChange($event)"
                      styleClass="width-full">
            </p-dropdown>
            <div class="ui-message ui-messages-error ui-corner-all"
                  *ngIf="paymentMethod.errors?.required && paymentMethod.touched" >
                  A payment Type is required
            </div>
        </div>

        <div class="ui-g-12 ui-md-3" *ngIf="selectedCasePayment.paymentMethod == 'Court Pay' || selectedCasePayment.receiptNumber != ''">
          <label class="minimal primary block" for="receiptNumber">Receipt Number</label>
            <textarea id="receiptNumber" name="receiptNumber"
              placeholder="Enter the Payment Receipt Number"
              [ngModel]="selectedCasePayment.receiptNumber"
              (ngModelChange)="receiptNumberOnChange($event)"
              [disabled]="((selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) 
                          || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))
                          || selectedCasePayment.paymentMethod != 'Court Pay')"
              [rows]="1" 
              [required]="true"
              pInputTextarea
              autoResize="autoResize"
              styleClass="width-full"></textarea>
        </div>        

      </div>

      <div class="ui-g-12">

            <div class="ui-g-12 ui-md-3">
              <label class="minimal primary block" for="tiTotalPaidIn">Payment by Customer</label>
                  <input matInput type="number" name="tiTotalPaidIn" placeholder="Total Amount Paid In"
                  [(ngModel)]="selectedCasePayment.totalPaymentIn"
                  [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                  (ngModelChange)="totalAmountPainInOnChange($event)">     
            </div>          

            <div class="ui-g-12 ui-md-3" *ngIf="selectedCasePayment.paymentMethod == 'Court Pay'">
               <label class="minimal primary block" for="tiProcessingFee">Processing Fee</label>
                  <input matInput type="number" name="tiProcessingFee" placeholder="Enter Processing Fees"
                     [(ngModel)]="selectedCasePayment.processingFee"
                     [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                     (ngModelChange)="processingFeeOnChange($event)">
            </div>      
              
            <div class="ui-g-12 ui-md-3" *ngIf="((selectedCasePayment.paymentType == 'Maintenance: Child' || 
            selectedCasePayment.paymentType == 'Maintenance: Adult'|| 
            selectedCasePayment.paymentType == 'Maintenance: Adult & Child'  || 
            selectedCasePayment.paymentType == 'Warrant of Commitment' || 
            selectedCasePayment.paymentType == 'Warrant of Apprehension' || 
            selectedCasePayment.paymentType == 'Writs of Execution') && (selectedCasePayment.paymentOID > 0))">  

            <label class="minimal primary block">Date of Disbursement</label>
                  <p-calendar id="dateOfDisbursement" name="dateOfDisbursement" placeholder="Disbursement Date"
                      [ngModel]="selectedCasePayment.disbursementDate"
                      (ngModelChange)="dateOfDisbursementOnChange($event)"
                      [showIcon]="true"
                      appendTo="body"
                      [inline]="false"
                      [required]="false"  
                      [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || !hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"                  
                      dateFormat="dd-M-yy"
                      [monthNavigator]="true" 
                      [yearNavigator]="true" 
                      yearRange="2000:2030"
                      [disabled]="selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)"
                      styleClass="width-full">
                  </p-calendar>
            </div>              
              
              <div class="ui-g-12 ui-md-3" *ngIf="selectedCasePayment?.disbursementDate != null">
                <label class="minimal primary block">Payment Disbursed?</label>  
                <p-checkbox
                    [ngModel]="selectedCasePayment?.paymentDisbursedFlag" binary="true" name="disbursementCompleted"
                    [required]="false"        
                     
                    [disabled]="permissionSupervisor == false && disbursementToggle == true"
                    (onChange)="disbursementCompletedOnChange($event)"
                    >            
                  </p-checkbox>
              </div>


      </div>

      <!-- Adding Payments Notes Field  -->
      <div class="ui-g-12">
          <label class="minimal primary block">Payment Notes</label>
              <textarea name="tiPaymentNotes"
                  [disabled]="((selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)))"
                  [rows]="2"
                  [cols]="30"
                  autoResize="autoResize"
                  pInputTextarea placeholder="Enter Payment Notes"
                  [(ngModel)]="selectedCasePayment.paymentNotes"
                  class="width-full">
              </textarea>
        </div>


      <div class="ui-g-12">

          <div class="ui-g-12 ui-md-6">
              <label class="minimal primary block">Payor Party</label>
              <p-dropdown name="ddPayorParty" id="ddPayorParty" #ddPayorParty="ngModel" placeholder="choose a Payor..."
                  [required]="true"
                  [options]="paymentCaseParties"
                  optionLabel="fullName"
                  [ngModel]="selectedCasePayment?.payorParty"
                  [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || !hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                  [filter]="true"
                  (onChange)="payorOnChange($event)"
                  styleClass="width-full">
              </p-dropdown>
          </div>
   
          <div class="ui-g-12 ui-md-6">
              <label class="minimal primary block">Beneficiary Party</label>
              <p-dropdown name="ddBeneficiaryParty" id="ddBeneficiaryParty"  #ddBeneficiaryParty="ngModel" placeholder="choose Beneficiary Party..."
                    [required]="true"
                    [options]="paymentCaseParties"
                    optionLabel="fullName"
                    [ngModel]="selectedCasePayment?.beneficiaryParty"
                    [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || !hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE)"
                    [filter]="true"
                    (onChange)="beneficiaryOnChange($event)"
                    styleClass="width-full">
              </p-dropdown>
            </div>  
      </div>   


            <!-- ADD PAYMENT ITEMS, FREQUENCY, PAYMENT DATE, PAYMENT FREQUENCY, PAYMENT AMOUNT-->

            <div class="ui-g-12 mt-0">
              <div class="ui-g-12">
                <header class="mb-10">Payment &amp; Disbursement Details</header>
              </div>
    
              <div class="ui-g-12 mb-5 paymentDetails-th">
                <div class="ui-g-2 pv-0">
                  <label class="minimal primary block">Period Start Date</label>
                </div>
                <div class="ui-g-2 pv-0">
                  <label class="minimal primary block">Period End Date</label>
                </div>
                <div class="ui-g-3 pv-0">
                  <label class="minimal primary block">Payment Item</label>
                </div>
                <div class="ui-g-2 pv-0">
                    <label class="minimal primary block">Payment Frequency</label>
                  </div>
                <div class="ui-g-1 pv-0">
                      <label class="minimal primary block">Payment Ordered</label>
                </div>
                <div class="ui-g-1 pv-0">
                  <label class="minimal primary block">Customer Payment</label>
                </div>
                <!--div class="ui-g-1 pv-0" *ngIf="selectedCasePayment?.paymentOID != 0">
                  <label class="minimal primary block">Amount Paid Out</label>
                </div-->
              </div>

    
              <div class="ui-g-12 mb-5 paymentsDisbursements-row" *ngFor="let paymentsDisbursements of selectedCasePayment.paymentsDisbursements; let acIdx = index">
                
                <div class="ui-g-2 ph-0 pv-5">
                    
                  <p-calendar 
                       placeholder="Period Start Date"
                      (ngModelChange)="periodStartDateOnChange($event,acIdx)"
                      [showIcon]="true"
                      appendTo="body"
                      [inline]="false"
                      [required]="true"
                      dateFormat="dd-M-yy"
                      [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                      [monthNavigator]="true" 
                      [yearNavigator]="true" 
                      yearRange="2000:2030"
                      id="paymentsDisbursements-paymentPeriodStartDate-{{acIdx}}"
                      [ngModel]="selectedCasePayment.paymentsDisbursements[acIdx].paymentPeriodStartDate"
                      name="paymentsDisbursements[{{acIdx}}].paymentPeriodStartDate">
                  </p-calendar>   
                  
                  
                </div>

                <div class="ui-g-2 ph-10 pv-5">
                  <p-calendar placeholder="Period End Date"
                      (ngModelChange)="periodEndDateOnChange($event,acIdx)"
                      [showIcon]="true"
                      appendTo="body"
                      [inline]="false"
                      [required]="true"                      
                      dateFormat="dd-M-yy"
                      [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                      [monthNavigator]="true" 
                      [yearNavigator]="true" 
                      yearRange="2000:2030"
                      id="paymentsDisbursements-paymentPeriodEndDate-{{acIdx}}"
                      [ngModel]="selectedCasePayment.paymentsDisbursements[acIdx].paymentPeriodEndDate"
                      name="paymentsDisbursements[{{acIdx}}].paymentPeriodEndDate">
                  </p-calendar>
                </div>

                <div class="ui-g-3 ph-10 pv-5">
                  <p-dropdown
                       placeholder="Choose Payment Item"
                      [required]="true"
                      [options]="paymentItem"
                      filter = "true"                      
                      appendTo="body"
                      [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                      (ngModelChange)="paymentItemOnChange($event,acIdx)"
                      styleClass="width-full"
                      id="paymentsDisbursements-paymentItem-{{acIdx}}"
                      [ngModel]="selectedCasePayment.paymentsDisbursements[acIdx].paymentItem"
                      name="paymentsDisbursements[{{acIdx}}].paymentItem">
                  </p-dropdown>
               </div>

               <div class="ui-g-2 ph-10 pv-5">
                  <p-dropdown
                      placeholder="Choose Payment Frequency"
                      [required]="true"
                      [options]="paymentFrequency"
                      filter = "true"
                      appendTo="body"
                      [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                      (ngModelChange)="paymentFrequencyOnChange($event,acIdx)"
                      id="paymentsDisbursements-paymentFrequency-{{acIdx}}"
                      [ngModel]="selectedCasePayment.paymentsDisbursements[acIdx].paymentFrequency"
                      name="paymentsDisbursements[{{acIdx}}].paymentFrequency"                      
                      styleClass="width-full">
                  </p-dropdown>
               </div>        
               
              <div class="ui-g-1 ph-10 pv-5">
                      <input matInput type="number"  
                        placeholder="Payment Ordered"
                        id="paymentsDisbursements-paymentAmountOrdered-{{acIdx}}"
                        [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                        [ngModel]="selectedCasePayment.paymentsDisbursements[acIdx].paymentAmountOrdered"
                        name="paymentsDisbursements[{{acIdx}}].paymentAmountOrdered"  
                        (ngModelChange)="paymentAmountOrderedOnChange($event,acIdx)">
              </div>               

              <div class="ui-g-1 ph-10 pv-5">
                    <input matInput type="number"  
                    placeholder="Payment Rendered"
                    (ngModelChange)="paymentAmountInOnChange($event,acIdx)"
                    [disabled]="(selectedCasePayment?.paymentDisbursedFlag == true && !hasPermission(Permission.CREATE_TASK)) || (!hasPermission(Permission.CREATE_CASE) && !hasPermission(Permission.UPDATE_CASE))"
                    id="paymentsDisbursements-paymentAmountIn-{{acIdx}}"
                    [ngModel]="selectedCasePayment.paymentsDisbursements[acIdx].paymentAmountIn"
                    name="paymentsDisbursements[{{acIdx}}].paymentAmountIn">                    
              </div>
  
                <div class="ui-g-1 ta-r mt-15 ph-10 pv-5">
                  <i class="material-icons delete-icon" (click)="requestDeleteCasePaymentDetail(acIdx)">delete</i>
                </div>
            </div>
         </div>
    </div>
    </div>

    <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30">
          <button label="Save Payment" type="submit" pButton icon="fa-check" 
                  [disabled]="!casePaymentForm.form.valid"
                  (click)="addCasePayment()"></button>

          <button label="Cancel" type="button" class="ui-button-secondary" pButton icon="fa-close"
                  (click)="onCancelCasePayment()">
          </button>                  

          <button type="button" (click)="addCasePaymentDisbursement();" label="Add Payment &amp; Disbursement"
                icon="ui-icon-add" class="ui-button-secondary mr-15"
                
                pButton>
        </button>
        </div>
    </p-footer>
  </form>
</p-dialog>



<!-- ADD JUDICIAL ASSIGNMENT MODAL -->

<p-dialog width="450" [(visible)]="showModalAddJudge" [responsive]="true" showEffect="fade" [modal]="true"
  [closable]="false">
  <p-header>
    {{ judge?.judicialAssignmentOID ? 'Edit' : 'Save' }} Judicial Assignment
  </p-header>
  <loading-bar [visible]="loadingJudgeLookups" [message]="'loading judicial data...'"></loading-bar>
  <form (ngSubmit)="saveJudge()" #caseJudgeForm="ngForm" novalidate>
    <div class="ui-g">
      <div class="form-group">

        <div class="ui-g-12 mb-15">
          <label class="minimal primary block">Judge</label>
          <div *ngIf="judge.judicialAssignmentOID > 0">{{judge.judicialOfficial.firstName}}
            {{judge.judicialOfficial.lastName}}</div>
          <div *ngIf="!judge.judicialAssignmentOID || judge.judicialAssignmentOID == 0">
            <p-dropdown name="ddJudge" id="ddJudge" placeholder="choose Judge..." #ddJudge="ngModel" [required]="true"
              [options]="judges" optionLabel="name" [(ngModel)]="judge.judicialOfficial"
              [disabled]="judge.judicialAssignmentOID > 0" styleClass="width-full">
            </p-dropdown>
            <div class="ui-message ui-messages-error ui-corner-all" *ngIf="ddJudge.errors?.required && ddJudge.touched">
              Please select a Judge
            </div>
          </div>
        </div>

        <!-- START DATE -->
        <div class="ui-g-12 mb-15">
          <p-calendar id="dtStartDate" name="dtStartDate" placeholder="Start Date" #dtStartDate="ngModel"
            [(ngModel)]="judge.startDate" [showIcon]="true" dateFormat="dd-M-yy" appendTo="body"></p-calendar>
          <div class="ui-message ui-messages-error ui-corner-all"
            *ngIf="dtStartDate.errors?.required && dtStartDate.touched">
            Please select a start date
          </div>
        </div>

        <!-- END DATE -->
        <div class="ui-g-12">
          <p-calendar id="dtEndDate" name="dtEndDate" placeholder="End Date" #dtEndDate="ngModel"
            [(ngModel)]="judge.endDate" [showIcon]="true" dateFormat="dd-M-yy" appendTo="body"></p-calendar>
        </div>

      </div>
    </div>

    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30">
        <button label="{{ judge?.judicialAssignmentOID ? 'Edit' : 'Save' }}  Judge" type="submit" pButton
          icon="fa-check" [disabled]="!caseJudgeForm.form.valid"></button>
        <button label="Cancel" class="ui-button-secondary" type="button" pButton icon="fa-close"
          (click)="hideModals()"></button>
      </div>
    </p-footer>

  </form>
</p-dialog>



<!-- ADD EVENT MODAL -->

<p-dialog header="Add Completed Event" width="450" [(visible)]="showModalAddEvent" [responsive]="true" showEffect="fade"
  [modal]="true" [closable]="false">
  <form (ngSubmit)="saveEvent()" #caseEventForm="ngForm" novalidate>
    <div class="ui-g">
      <div class="form-group">

        <!-- EVENT DATE -->
        <div class="ui-g-12">
          <label class="minimal primary block">Event Date</label>
          <p-calendar id="dtEventDate" name="dtEventDate" placeholder="Event Date" #dtEventDate="ngModel"
            [(ngModel)]="caseEvent.eventDate" [showIcon]="true" dateFormat="dd-M-yy"
            [disabled]="caseEvent.caseEventOID && caseEvent.caseEventOID > 0" appendTo="body"></p-calendar>
          <div class="ui-message ui-messages-error ui-corner-all"
            *ngIf="dtEventDate.errors?.required && dtEventDate.touched">
            Please select a event date
          </div>
        </div>

        <!-- EVENT ID -->
        <div class="ui-g-12 mb-15">
          <label class="minimal primary block">Event Description</label>
          <p-dropdown name="ddEventId" id="ddEventId" placeholder="choose Event Description..." #ddEventId="ngModel"
            [required]="true" [options]="eventTypes" optionLabel="description" [(ngModel)]="caseEvent.eventType"
            [disabled]="caseEvent.caseEventOID && caseEvent.caseEventOID > 0" styleClass="width-full">
          </p-dropdown>
          <div class="ui-message ui-messages-error ui-corner-all"
            *ngIf="ddEventId.errors?.required && ddEventId.touched">
            Please select an Event
          </div>
        </div>

        <div class="ui-md-12 mb-15" *ngIf="caseEvent.caseEventOID && caseEvent.caseEventOID > 0">
          <label class="minimal primary block">Event Category</label>
          <div>{{caseEvent.eventType?.eventCategoryText}}</div>
        </div>

        <!-- INITIATED BY
          REMOVED ON 2/8/2018 PER AG
        -->
        <!-- <div class="ui-g-12">
          <label class="minimal primary block">Event Initiated By</label>
          <p-dropdown name="ddInitiator" id="ddInitiator" placeholder="choose initiator..." #ddInitiator="ngModel"
              [required]="true"
              [options]="case?.caseParties"
              optionLabel="caseParty.lastName"
              [(ngModel)]="selectedInitiatedByParty"
              [disabled]="caseEvent.caseEventOID && caseEvent.caseEventOID > 0"
              styleClass="width-full">
          </p-dropdown>
          <label class="minimal block"
                *ngIf="caseEvent.caseEventOID && caseEvent.caseEventOID > 0">
                    [Awaiting property 'initatedBy' on Case > CaseEvent returned from server]
          </label>
          <div class="ui-message ui-messages-error ui-corner-all"
                *ngIf="ddInitiator.errors?.required && ddInitiator.touched" >
                Please select Initiator of the Event
          </div>
        </div> -->

        <!-- ENTERED BY -->
        <div class="ui-g-12 mb-15" *ngIf="caseEvent.caseEventOID && caseEvent.caseEventOID > 0">
          <label class="minimal primary block">Event Entered by:</label>
          <div>{{caseEvent.enteringParty?.firstName}} {{caseEvent.enteringParty?.lastName}}</div>
        </div>

        <!-- DURATION -->
        <div class="ui-g-12 mt-15">
          <span class="md-inputfield">
            <input pInputText id="tiEventDuration" name="tiEventDuration" class="width-full"
              [(ngModel)]="caseEvent.durationTimeMin" />
            <label>Event Duration (Min)</label>
          </span>
        </div>

        <!-- EVENT DOCUMENT -->
        <!-- <div class="ui-g-12">
          <label class="minimal primary block">Document</label>
          <p-dropdown name="ddDocuments" id="ddDocuments" placeholder="choose Document..."
              [options]="documentTemplateTypes"
              optionLabel="documentName"
              [(ngModel)]="caseEvent.docTemplate"
              styleClass="width-full">
          </p-dropdown>
        </div> -->

        <!-- EVENT DETAILS  -->

        <!-- <div class="ui-g-12 mt-15">
          <span class="md-inputfield">
            <input pInputText id="tiEventDesc" name="tiEventDesc" class="width-full"
                    [(ngModel)]="caseEvent.description"/>
            <label>Event Details</label>
          </span>
        </div> -->

        <div class="ui-g-12 mt-15">
          <label class="minimal primary block" for="taDesc">Event Details</label>
          <textarea id="tiEventDesc" name="tiEventDesc" [(ngModel)]="caseEvent.description" [rows]="2" pInputTextarea
            autoResize="autoResize" class="width-full"></textarea>
        </div>
      </div>
    </div>

    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix mt-30">
        <button label="Add Case Event" type="submit" pButton icon="fa-check"
          [disabled]="!caseEventForm.form.valid"></button>
        <button label="Cancel" class="ui-button-secondary" type="button" pButton icon="fa-close"
          (click)="hideModals()"></button>
      </div>
    </p-footer>

  </form>
</p-dialog>


<!-- ADD HEARING MODAL -->
<!-- Replaced by Hearing.Component -->
